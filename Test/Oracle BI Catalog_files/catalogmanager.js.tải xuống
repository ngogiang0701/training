if(window.obips_catalogmanager){}else{window.obips_catalogmanager=1;if(!obips){obips=function(){}}if(!obips.catalog){obips.catalog=function(){}}if(!obips.catalog.cache){obips.catalog.cache=function(){}}if(!obips.security){obips.security=function(){}}obips.catalog.Catalog=function(){var a=obips.getSingleton(obips.catalog.Catalog.SINGLETON_NAME);if(a){return a}obips.catalog.Catalog.baseConstructor.call(this);this.cacheManager=null;if(obips.ResourceManager.getSingleton().getGDExpression("catalog/privileges.xml","catalogManagerCacheEnable").value){this.cacheManager=new obips.catalog.cache.Manager();this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEMS_DELETED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEMS_INVALIDATED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEMS_COPIED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEMS_UPDATED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEMS_MOVED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEMS_CREATED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEM_RENAMED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)));this.addEventListener(new obips.Observable.EventListener(obips.catalog.EventType.ITEM_UPDATED,new obips.Callback(this.cacheManager,this.cacheManager.invalidateCache)))}globalRegister.addObject(obips.catalog.Catalog.SINGLETON_NAME,this)};saw.extend(obips.catalog.Catalog,obips.Observable);obips.catalog.Catalog.SINGLETON_NAME="catalogManager";obips.catalog.Catalog.getSingleton=function(){var a=obips.getSingleton(obips.catalog.Catalog.SINGLETON_NAME);if(!a){a=new obips.catalog.Catalog()}return a};obips.catalog.ItemProperty={NameLimit:"NameLimit",PathLimit:"PathLimit",DescriptionLimit:"DescriptionLimit"};obips.catalog.Catalog.PropertiesLimits={NameLimit:512,PathLimit:16384,DescriptionLimit:1024};obips.catalog.Catalog.getPropertyLimit=function(a){return obips.catalog.Catalog.PropertiesLimits[a]};obips.catalog._reEscapeSearchString=/\\\\|\\([^~^\?\*\\\/]|$)/g;obips.catalog.escapeSearchString=function(a){a=saw.trim(a);a=a.replace(obips.catalog._reEscapeSearchString,"\\\\$1");return a};obips.catalog.Path=function(){};obips.catalog._reEscapedItemNameToItemName=/\\([\*\?\\\/~])/g;obips.catalog._reItemNameToEscapedItemName=/([\*\?\\\/~])/g;obips.catalog._reGetEscapedItemName=/(.*)\/([^\/]+)$/;obips.catalog._reGetParentPath=/^(\/.*[^\\])\/(?:[^\/]+|[^\/]*\\\/[^\/]*)+$/;obips.catalog._getPathStatusString=function(c){var b="";if(c){for(var a=0;a<c.length;a++){if(c[a].status==obips.catalog.StatusCode.OTHER_ERROR){if(b){b+="\n"}b+=c[a].error}}}return b};obips.catalog.Path.getItemName=function(b){if(!b){return b}var a=obips.catalog._reGetEscapedItemName.exec(b);if(a){if(!a[1]||a[1].charAt(a[1].length-1)!="\\"){return a[2].replace(obips.catalog._reEscapedItemNameToItemName,"$1")}}var c=saw.getLastPathPart(b);return c.replace(obips.catalog._reEscapedItemNameToItemName,"$1")};obips.catalog.Path.getParentPath=function(b){var a=obips.catalog._reGetParentPath.exec(b);var c="";if(a){c=a[1]}else{if(b!="/"){c="/"}}return c};obips.catalog.Path.concat=function(a,b){if(!a||!b){return null}return a+(a=="/"?"":"/")+b.replace(obips.catalog._reItemNameToEscapedItemName,"\\$1")};obips.catalog.Path.split=function(a){var b=[];do{b.push(obips.catalog.Path.getItemName(a));a=obips.catalog.Path.getParentPath(a)}while(a!="");b.reverse();return b};obips.catalog.Path.join=function(c){var a="/";for(var b=1;b<c.length;++b){a=obips.catalog.Path.concat(a,c[b])}return a};obips.catalog.EventType=function(){};obips.catalog.EventType.ITEMS_DELETED=1;obips.catalog.EventType.ITEM_DELETED=2;obips.catalog.EventType.ITEMS_INVALIDATED=3;obips.catalog.EventType.ITEM_INVALIDATED=4;obips.catalog.EventType.ITEMS_UPDATED=5;obips.catalog.EventType.ITEM_UPDATED=6;obips.catalog.EventType.ITEMS_CREATED=7;obips.catalog.EventType.ITEM_CREATED=8;obips.catalog.CopyMoveEventContext=function(a,b){this.srcPath=a;this.destItemInfo=b};obips.catalog.EventType.ITEMS_MOVED=9;obips.catalog.EventType.ITEM_MOVED=10;obips.catalog.EventType.ITEMS_COPIED=11;obips.catalog.EventType.ITEM_COPIED=12;obips.catalog.EventType.ITEM_RENAMED=13;obips.catalog.RenamedEventContext=function(a,b){this.srcPath=a;this.destItemInfo=b};obips.catalog.Catalog.prototype.fireEvent=function(c,b){switch(c){case obips.catalog.EventType.ITEMS_DELETED:case obips.catalog.EventType.ITEMS_INVALIDATED:case obips.catalog.EventType.ITEMS_UPDATED:case obips.catalog.EventType.ITEMS_CREATED:case obips.catalog.EventType.ITEMS_MOVED:case obips.catalog.EventType.ITEMS_COPIED:var a=this;obips.Array.forEach(b,function(d){a.notify(new obips.Observable.Event(c+1,d))});this.notify(new obips.Observable.Event(c,b));break;case obips.catalog.EventType.ITEM_DELETED:case obips.catalog.EventType.ITEM_INVALIDATED:case obips.catalog.EventType.ITEM_UPDATED:case obips.catalog.EventType.ITEM_CREATED:case obips.catalog.EventType.ITEM_MOVED:case obips.catalog.EventType.ITEM_COPIED:this.notify(new obips.Observable.Event(c,b));this.notify(new obips.Observable.Event(c-1,[b]));break;case obips.catalog.EventType.ITEM_RENAMED:this.notify(new obips.Observable.Event(c,b));break;default:alert("Invalid Event Type!");break}};obips.catalog.ReturnCode={SUCCESS:0,ERROR_PATH_NOT_FOUND:1,ERROR_PATH_NOT_INVALID:2,ERROR_ACCESS_DENIED:5,ERROR_ITEM_ALREADY_EXISTS:20,ERROR_ITEM_MORE_RECENT:21,ERROR_OTHER:38};obips.catalog.PathErrorInfo=function(c,b,a){this.path=c;this.code=b;this.error=a};obips.catalog.ReplaceFlags=function(){};obips.catalog.ReplaceFlags.REPLACE_NONE=1;obips.catalog.ReplaceFlags.REPLACE_NEWER=2;obips.catalog.ReplaceFlags.REPLACE_ALL=3;obips.catalog.ACLAction=function(){};obips.catalog.ACLAction.ACL_INHERIT=0;obips.catalog.ACLAction.ACL_PRESERVE=1;obips.catalog.CatalogWriteHelper=function(e,c,g,b,f,a,d,h){this.overwrite=e?true:false;this.attributes=c||obips.catalog.ItemAttributes.NORMAL;this.properties=g;this.acl=b;this.ownerGUID=f;this.ownerType=a;this.createDirectoryHierarchy=d||false;this.expectedLastModified=h};obips.catalog.CatalogWriteHelper.parseJSON=function(a){return new obips.catalog.CatalogWriteHelper(a.overwrite,a.attributes,a.properties,a.acl,a.ownerGUID,a.ownerType,a.createDirectoryHierarchy,a.expectedLastModified)};obips.catalog.CatalogWriteHelper.prototype.setDescription=function(a){if(a){if(!this.properties){this.properties={}}this.properties.Desc=a}else{if(this.properties){delete this.properties.Desc}}};obips.catalog.CatalogWriteHelper.prototype._addToRequestArgs=function(a){if(this.overwrite){a.addArg("repl","t")}if(this.attributes){a.addArg("attrFlags",this.attributes)}if(this.properties){a.addArg("props",saw.json.toString(this.properties))}if(this.acl){a.addArg("acl",tACL.toJSONString())}if(this.ownerGUID){a.addArg("ownerguid",this.ownerGUID);if(this.ownerType){a.addArg("ownertype",this.ownerType)}}if(this.createDirectoryHierarchy){a.addArg("createDirs","t")}if(this.overwrite&&this.expectedLastModified){a.addArg("modifiedTime",this.expectedLastModified)}};obips.catalog.StatusCode=function(){};obips.catalog.StatusCode.ITEM_ALREADY_EXISTS=0;obips.catalog.StatusCode.UNSUPPORTED_REPLACE=1;obips.catalog.StatusCode.CONFIRM_REPLACE=2;obips.catalog.StatusCode.CONFIRM_FORCE_DELETE=3;obips.catalog.StatusCode.FOLDER_ONLY_IN_SHARED=4;obips.catalog.StatusCode.OTHER_ERROR=8;obips.catalog.FolderType=function(){};obips.catalog.FolderType.FOLDER=1;obips.catalog.FolderType.OBJECT=2;obips.catalog.FolderType.EXPANDABLE=3;obips.catalog.ItemType=function(){};obips.catalog.ItemType.FOLDER=1;obips.catalog.ItemType.LINK=2;obips.catalog.ItemType.OBJECT=4;obips.catalog.ItemType.MISSING=8;obips.catalog.ItemType.NOACCESS=16;obips.catalog.ItemType.CIRCULAR=32;obips.catalog.ItemAttributes=function(){};obips.catalog.ItemAttributes.NORMAL=0;obips.catalog.ItemAttributes.READ_ONLY=1;obips.catalog.ItemAttributes.ARCHIVE=2;obips.catalog.ItemAttributes.HIDDEN=4;obips.catalog.ItemAttributes.SYSTEM=8;obips.catalog.ItemAttributes.HIDDEN_SYSTEM=4|8;obips.catalog.ItemAttributes.DO_NOT_INDEX=16;obips.catalog.ItemPermissions=function(){};obips.catalog.ItemPermissions.NONE=0;obips.catalog.ItemPermissions.READ=1;obips.catalog.ItemPermissions.EXECUTE=2;obips.catalog.ItemPermissions.WRITE=4;obips.catalog.ItemPermissions.DELETE=8;obips.catalog.ItemPermissions.CHANGE_PERMISSIONS=16;obips.catalog.ItemPermissions.SET_OWNERSHIP=32;obips.catalog.ItemPermissions.PUBLISHER_RUNLIVE=2048;obips.catalog.ItemPermissions.PUBLISHER_SCHEDULE=4096;obips.catalog.ItemPermissions.PUBLISHER_VIEWOUTPUT=8192;obips.catalog.ItemPermissions.FULL_CONTROL=65535;obips.catalog.OperationPermissions={READ:1,WRITE:2,DELETE:4,CHANGE_PERMISSIONS:8,SET_OWNERSHIP:16,RENAME:32,SEE_PERMISSIONS:64,SET_PROPERTIES:128,GET_PROPERTIES:256,DELETE_RENAME_SUBITEMS:512,SET_ATTRIBUTES:4096,BIP_RUN_LIVE:8192,BIP_SCHEDULE:16384,BIP_VIEW_OUTPUT:32768,FULL_CONTROL:65535};obips.catalog.UpdateACLFlag=function(){};obips.catalog.UpdateACLFlag.REPLACE_ALL=0;obips.catalog.UpdateACLFlag.REPLACE_MENTIONED=1;obips.catalog.UpdateACLFlag.DELETE_MENTIONED=2;obips.security.ACL=function(a){this.tokens=a?a:[]};obips.security.ACL.cloneACL=function(a){var g=new Array();for(var c=0;c<a.tokens.length;c++){var e=a.tokens[c];var b=new obips.security.Account(e.account.name,e.account.id,e.account.type,e.account.bSacred,e.account.bIsInternal,e.account.displayName);var f=new obips.security.AccessControlToken(b,e.permissions);g[c]=f}var d=new obips.security.ACL(g);return d};obips.security.ACL.prototype.toXML=function(){var f=XUICreateElement(saw.xml.kSawNamespace,"ACL");var e=this.getTokens();for(var b=0;b<e.length;++b){var a=e[b];var c;switch(a.account.type){case obips.security.EAccountType.USER:c="user";break;case obips.security.EAccountType.GROUP:c="group";break;case obips.security.EAccountType.APPROLE:c="approle";break;default:continue}var d=XUIAppendNewElement(f,saw.xml.kSawNamespace,c);d.setAttribute("name",a.account.name);d.setAttribute("id",a.account.id);d.setAttribute("access",obips.security.ACL.convertPermissionToString(a.permissions))}return f};obips.security.ACL.convertPermissionToString=function(a){if((a&obips.catalog.ItemPermissions.FULL_CONTROL)==obips.catalog.ItemPermissions.FULL_CONTROL){return"RXWDOP"}else{if((a&obips.catalog.ItemPermissions.DELETE)!=0){return"RXWD"}else{if((a&obips.catalog.ItemPermissions.READ)!=0){return"RX"}else{if((a&obips.catalog.ItemPermissions.EXECUTE)!=0){return"X"}else{return""}}}}};obips.security.ACL.convertStringToPermission=function(b){if(b=="RXWDOP"){return 65535}var a=0;for(var c=0;c<b.length;++c){switch(b.charAt(c)){case"R":a|=1;break;case"X":a|=2;break;case"W":a|=4;break;case"D":a|=8;break}}return a};obips.security.ACL.parseXML=function(a){var b=a?a.selectNodes("./*"):null;return new obips.security.ACL(b?obips.Array.map(b,function(c){return obips.security.AccessControlToken.parseXML(c)}):[])};obips.security.ACL.parseJSON=function(a){return new obips.security.ACL(a?obips.Array.map(a,function(b){return obips.security.AccessControlToken.parseJSON(b)}):[])};obips.security.ACL.prototype.toJSONString=function(){var a=[];if(this.getTokens()){a=obips.Array.map(this.getTokens(),function(b){return{guid:b.account.id,name:b.account.name,type:b.account.type,permissions:b.permissions}})}return saw.json.toString(a,true)};obips.security.EAccountType=function(){};obips.security.EAccountType.USER=0;obips.security.EAccountType.GROUP=1;obips.security.EAccountType.INVALID=2;obips.security.EAccountType.UNKNOWN=3;obips.security.EAccountType.APPROLE=4;obips.security.EAccountType.INITBLOCKUSER=5;obips.security.Account=function(e,f,b,c,a,d){this.name=e;this.id=f;this.type=b;this.bIsSacred=c;this.bIsInternal=a;this.displayName=d};obips.security.Account.parseJSON=function(a){return new obips.security.Account(a.name,a.guid,a.type,null,a.internal=="true"?true:false,a.displayName)};obips.security.AccessControlToken=function(a,b){this.account=a;this.permissions=b};obips.security.AccessControlToken.parseXML=function(a){var b=obips.security.EAccountType.INVALID;if(a.nodeName=="saw:user"){b=obips.security.EAccountType.USER}else{if(a.nodeName=="saw:group"){b=obips.security.EAccountType.GROUP}else{if(a.nodeName=="saw:approle"){b=obips.security.EAccountType.APPROLE}}}return new obips.security.AccessControlToken(new obips.security.Account(a.getAttribute("name"),a.getAttribute("id"),b),obips.security.ACL.convertStringToPermission(a.getAttribute("access")))};obips.security.AccessControlToken.parseJSON=function(a){return new obips.security.AccessControlToken(obips.security.Account.parseJSON(a),a.permissions)};obips.security.ACL.prototype.addPermission=function(d,e){var c=new obips.security.AccessControlToken(d,e);var b=this._getACLTokenIndex(d.guid);if(saw.checkObjectReference(b)){var a=this.tokens[b];a.permissions=e;this.tokens[b]=a}else{this.tokens.push(c)}};obips.security.ACL.prototype.getPermission=function(c){var a=0;var b=this._getACLTokenIndex(c);if(saw.checkObjectReference(b)){a=this.tokens[b].permissions}return a};obips.security.ACL.prototype._getACLTokenIndex=function(c){for(var b=0;b<this.tokens.length;++b){var a=this.tokens[b];if(a.account.id==c){return b}}return null};obips.security.ACL.prototype.isAccountInACL=function(b){var a=this._getACLTokenIndex(b);return !(a==null)};obips.security.ACL.prototype.removePermission=function(b){var a=this._getACLTokenIndex(b);if(saw.checkObjectReference(a)){this.tokens.splice(a,1)}};obips.security.ACL.prototype.updatePermission=function(c,d){var b=this._getACLTokenIndex(c);if(saw.checkObjectReference(b)){var a=this.tokens[b];a.permissions=d;this.tokens[b]=a}};obips.security.ACL.prototype.getTokens=function(){return this.tokens};obips.security.ACL.prototype.isAccountDetailsResolved=function(){return this.getTokens().length>0&&this.getTokens()[0].account.name!=null};obips.catalog.ItemInfoDetailLevel=function(a,b,c){this.extendedAttrLevel=a||obips.catalog.ExtendedAttrLevel.NORMAL;this.aclDetailLevel=(b?1:0)+(c?2:0)};obips.catalog.ItemInfoDetailLevel.prototype._addToRequestArgs=function(a){if(this.extendedAttrLevel){a.addArg("extattrlevel",this.extendedAttrLevel)}if(this.aclDetailLevel){a.addArg("acllevel",this.aclDetailLevel)}};obips.catalog.ItemInfo=function(b,c,a,d,e){this.path=b;this.type=c;this.caption=a;this.description=null;this.ownerAccount=null;this.attributes=null;this.permissions=null;this.lastModified=null;this.lastModifiedDisplay=null;this.created=null;this.createdDisplay=null;this.accessed=null;this.accessedDisplay=null;this.signature=d;this.properties=e;this.acl=null;this.extendedAttributes=null;this.contentState=null;this.internalProperties=null;this.targetType=null;this.targetSignature=null;this.targetCompositeSignature=null;this.targetPath=null;this.badLink=false};obips.catalog.ItemInfo.parseJSON=function(b){var a=new obips.catalog.ItemInfo();a.updateFromJson(b);return a};obips.catalog.ItemInfo.prototype.updateFromJson=function(a){this.path=a.path;this.type=a.type;this.caption=a.caption;this.description=a.description;this.owner=a.owner;this.ownerGUID=a.ownerGUID;this.ownerType=a.ownerType;this.ownerAccount=new obips.security.Account(a.owner,a.ownerGUID,a.ownerType);this.attributes=a.attributes;this.permissions=a.permissions;this.operationPermissions=a.operationPermissions;this.lastModified=a.lastModified;this.lastModifiedDisplay=a.lastModifiedDisplay;this.created=a.created;this.createdDisplay=a.createdDisplay;this.accessed=a.accessed;this.accessedDisplay=a.accessedDisplay;this.signature=a.signature;this.properties=a.properties;this.acl=a.acl?obips.security.ACL.parseJSON(a.acl):null;this.extendedAttributes=a.extendedAttributes;this.contentState=a.contentState;this.internalProperties=a.internalProperties;this.targetType=a.targetType||null;this.targetSignature=a.targetSignature||null;this.targetCompositeSignature=a.targetCompositeSignature||null;this.targetPath=a.targetPath||null;this.badLink=a.badLink||false;this.isFavorite=a.isFavorite||false};obips.catalog.ItemInfo.prototype.hasHiddenAttribute=function(){return(this.attributes&obips.catalog.ItemAttributes.HIDDEN)==obips.catalog.ItemAttributes.HIDDEN};obips.catalog.ItemInfo.prototype.isHidden=obips.catalog.ItemInfo.prototype.hasHiddenAttribute;obips.catalog.ItemInfo.prototype.hasSystemAttribute=function(){return(this.attributes&obips.catalog.ItemAttributes.SYSTEM)==obips.catalog.ItemAttributes.SYSTEM};obips.catalog.ItemInfo.prototype.hasArchiveAttribute=function(){return(this.attributes&obips.catalog.ItemAttributes.ARCHIVE)==obips.catalog.ItemAttributes.ARCHIVE};obips.catalog.ItemInfo.prototype.hasReadOnlyAttribute=function(){return(this.attributes&obips.catalog.ItemAttributes.READ_ONLY)==obips.catalog.ItemAttributes.READ_ONLY};obips.catalog.ItemInfo.prototype.hasDoNotIndexAttribute=function(){return(this.attributes&obips.catalog.ItemAttributes.DO_NOT_INDEX)==obips.catalog.ItemAttributes.DO_NOT_INDEX};obips.catalog.ItemInfo.prototype.isWritable=function(){return !this.hasReadOnlyAttribute()&&((this.permissions&obips.catalog.ItemPermissions.WRITE)!=0)};obips.catalog.ItemInfo.prototype.getItemName=function(b){var a=(this.type==obips.catalog.ItemType.LINK&&b)?this.targetPath:this.path;return obips.catalog.Path.getItemName(a)};obips.catalog.ItemInfo.prototype.getCompositeSignature=function(a){if(!this.isLink()){return this.properties?this.properties.compositeSignature:null}else{return this.targetCompositeSignature}};obips.catalog.ItemInfo.prototype.getFolderType=function(c){var a=this.type==obips.catalog.ItemType.FOLDER||c&&this.type==obips.catalog.ItemType.LINK&&this.targetType==obips.catalog.ItemType.FOLDER;if(a){var b=saw.catalog.getObjectTypeInfo(this.getCompositeSignature(c));if(b){return b.folderType}else{return obips.catalog.FolderType.FOLDER}}return null};obips.catalog.ItemInfo.prototype.isLink=function(){return this.type==obips.catalog.ItemType.LINK};obips.catalog.ItemInfo.prototype.isSupported=function(){var b=this.getObjectTypeInfo();if(!b||b.supportType==saw.catalog.SupportType.SUPPORTED){return true}if(b.supportType==saw.catalog.SupportType.NOT_SUPPORTED){return false}if(this.signature==="coibot1"){var d=this.internalProperties;var c=d&&d.hasOwnProperty("DeliversLite")&&d.DeliversLite==="true";var a=false;if(c&&!a||!c&&a){return false}}return true};obips.catalog.ItemInfo.prototype.getObjectTypeInfo=function(b){var a=this.signature||(b&&this.targetSignature)||this.getCompositeSignature(b);return saw.catalog.getObjectTypeInfo(a)};obips.catalog.ItemInfo.prototype.equals=function(a){if(this.path!=a.path){return false}if(this.type!=a.type){return false}if(this.caption!=a.caption){return false}if(this.description!=a.description){return false}if(this.attributes!=a.attributes){return false}if(this.lastModified!=a.lastModified){return false}if(this.created!=a.created){return false}if(this.lastAccessed!=a.lastAccessed){return false}if(this.signature!=a.signature){return false}for(x in this.properties){if(this.properties[x]!=a.properties[x]){return false}}for(x in a.properties){if(this.properties[x]!=a.properties[x]){return false}}if(this.targetType!=a.targetType){return false}if(this.targetSignature!=a.targetSignature){return false}if(this.targetPath!=a.targetPath){return false}return true};obips.catalog.BISearchItemInfo=function(){this.promptString=null;this.queryString=null};extend(obips.catalog.BISearchItemInfo,obips.catalog.ItemInfo);obips.catalog.BISearchItemInfo.parseJSON=function(b){var a=new obips.catalog.BISearchItemInfo();a.updateFromJson(b);a.promptString=b.promptString;a.queryString=b.queryString;return a};obips.catalog.SearchFacets=function(){this.usedFacets=null;this.availableFacets=null};obips.catalog.SearchFacets.parseJSON=function(a,b){var c=new obips.catalog.SearchFacets();if(a){c.usedFacets=obips.Array.map(a,function(d){return obips.catalog.FacetItem.parseJSON(d)})}if(b){c.availableFacets=obips.Array.map(b,function(d){return obips.catalog.FacetItem.parseJSON(d,c.usedFacets)})}return c};obips.catalog.FacetItem=function(a){this.name=null;this.caption=null;this.count=null;this.facetValues=null;this.type=a?"checkbox":"link"};obips.catalog.FacetItem.prototype.hasValue=function(b){if(this.facetValues&&this.facetValues.length>0){for(var a=0;a<this.facetValues.length;a++){if(this.facetValues[a].value==b){return true}}}return false};obips.catalog.FacetItem.parseJSON=function(e,b){var d=new obips.catalog.FacetItem();d.name=e.name;d.caption=e.caption;d.count=e.count;var a=null;for(var c=0;b&&c<b.length;c++){if(b[c].name==d.name){a=b[c];break}}d.facetValues=obips.Array.map(e.facetValues,function(f){return obips.catalog.FacetValue.parseJSON(f,a)});return d};obips.catalog.FacetValue=function(){this.value=null;this.caption=null;this.count=null;this.selected=false};obips.catalog.FacetValue.parseJSON=function(c,a){var b=new obips.catalog.FacetValue();b.value=c.value;b.caption=c.caption;b.count=c.count;if(a){b.selected=a.hasValue(b.value)}return b};obips.catalog.AsyncResponseBase=function(a,b){this.errorMsg=a;this.errorCode=b};obips.catalog.AsyncResponseBase.prototype.isError=function(){return typeof(this.errorMsg)=="string"||this.errorCode};obips.catalog.AsyncResponseBase.prototype.getErrorMessage=function(){return this.isError()?this.errorMsg:""};obips.catalog.AsyncResponseBase.prototype.getReturnCode=function(){return this.errorCode};obips.catalog.CommonResponse=function(a,b){obips.catalog.CommonResponse.baseConstructor.call(this,b);this.itemInfo=a};saw.extend(obips.catalog.CommonResponse,obips.catalog.AsyncResponseBase);obips.catalog.ResponseWithPostProcessStatus=function(b,a){obips.catalog.ResponseWithPostProcessStatus.baseConstructor.call(this,a);this.postProcessStatuses=b};saw.extend(obips.catalog.ResponseWithPostProcessStatus,obips.catalog.AsyncResponseBase);obips.catalog.ResponseWithPostProcessStatus.prototype.getPostProcessMessage=function(){var b="";if(this.postProcessStatuses){for(var a=0;a<this.postProcessStatuses.length;a++){if(this.postProcessStatuses[a].status){if(b){b+="\n"}b+=this.postProcessStatuses[a].message}}}return b};obips.catalog._collapseErrors=function(a){var b=null;if(a){b="";obips.Array.forEach(a,function(c,d){if(d!=0){b+="\n"}b+=c.message})}return b};obips.catalog._resolveBoolean=function(a,c){return typeof(a)=="boolean"?a:c};obips.catalog.Catalog.prototype._operationCommonErrorCB=function(b,d,a){var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.CommonResponse(null,c))}else{alert(c)}};obips.catalog.Catalog.prototype._sentRequest=function(g,h,e){var d=saw.ajax.createConnection(g);if(h){d.setSync(true)}var f=d.post();if(f){var k=null;if(f.errors){k=[];for(var c=0;c!=f.errors.length;++c){var a=f.errors[c];for(var b=0;b!=a.length;++b){k.push(a[b])}}}if(k&&!e){throw new Error(obips.catalog._collapseErrors(k))}else{g.fCallback.call(g.tCallerObj,f.response,g.tContextInfo)}return{errors:k,response:f.response}}return null};obips.catalog.Catalog.prototype.favoritesUpdated=function(a){this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEM_UPDATED,a))};obips.catalog.Catalog.prototype._singleObjectUpdatedCB=function(c,a){var c=c.getJSON();var b=obips.catalog.ItemInfo.parseJSON(c);this.fireEvent(obips.catalog.EventType.ITEM_UPDATED,b);if(a.cb){a.cb.exec(new obips.catalog.CommonResponse(b,null))}};obips.catalog.Catalog.prototype._objectsUpdatedCB=function(c,a){var c=c.getJSON();var b=obips.catalog.ItemInfo.parseJSON(c);this.fireEvent(obips.catalog.EventType.ITEM_UPDATED,b);this.fireEvent(obips.catalog.EventType.ITEM_INVALIDATED,b.path);if(a.cb){a.cb.exec(new obips.catalog.CommonResponse(b,null))}};obips.catalog.SearchResponse=function(a,f,b,d,c,e){obips.catalog.SearchResponse.baseConstructor.call(this,f);this.itemInfos=a;this.resultsTruncated=b;this.biSearchIndexUpdateDateTime=c;this.isBISearch=d;this.searchFacets=e};saw.extend(obips.catalog.SearchResponse,obips.catalog.AsyncResponseBase);obips.catalog.SearchTarget=function(d,g,a,f,c,e,b){this.mask=d;this.recurse=g||false;this.resolveLinks=a||false;this.signatures=f;this.compositeSignatures=c;this.withPermission=obips.catalog.ItemPermissions.READ;this.withPermissionMask=obips.catalog.ItemPermissions.READ;this.facetAttributes=e;this.bShowHiddenValues=b||false};obips.catalog.Catalog.prototype.searchEx=function(g,c,m,f){if(!g){throw new Error("Path must be specified.")}var e=this.cacheManager?this.cacheManager.getSearchResults(g,c,m):null;if(e){var k=new obips.catalog.SearchResponse(e.itemInfos,null,e.truncated);if(f){setTimeout(function(){f.exec(k)},0);return null}else{return k}}var b=((!c.mask||c.mask=="*")&&!obips.catalog._resolveBoolean(c.recurse));var i=!b&&saw.catalog.getPrivilege("bUseBISearch");var l=new saw.ajax.Request("CatalogTreeModel",this._searchCB,this,{cb:f,searchCriteria:c,path:g,itemInfoDetailLevel:m,bUseBISearch:i});l.addArg("action","search");l.addArg("path",g);l.addArg("mask",c.mask||"*");l.addArg("recurse",obips.catalog._resolveBoolean(c.recurse)?"t":"f");l.addArg("followLinks",obips.catalog._resolveBoolean(c.resolveLinks)?"t":"f");l.addArg("withperm",c.withPermission);l.addArg("withpermmask",c.withPermissionMask);l.addArg("showHiddenValues",obips.catalog._resolveBoolean(c.bShowHiddenValues)?"true":"false");if(c.filterName){l.addArg("filterName",c.filterName)}if(c.includeFolders){l.addArg("includeFolders",obips.catalog._resolveBoolean(c.includeFolders)?"t":"f")}if(c.adminMode){l.addArg("admin","t")}if(c.signatures){l.addArg("sig",c.signatures.join(","))}if(c.compositeSignatures){l.addArg("compositeSig",c.compositeSignatures.join(","))}if(c.facetAttributes){l.addArg("facetAttributes",c.facetAttributes)}if(m){m._addToRequestArgs(l)}l.setFatalErrorHandler(this._searchErrorCB);var j=this._sentRequest(l,f==null);if(j){var d=j.response.getJSON();var a=d.itemsinfos;if(this.cacheManager){this.cacheManager.cacheSearchResults(g,c,m,d)}var h=obips.Array.map(a,function(n){return obips.catalog.ItemInfo.parseJSON(n)});return new obips.catalog.SearchResponse(h,null,d.truncated)}};obips.catalog.Catalog.prototype.search=function(c,e,f,b,d,a){return this.searchEx(c,new obips.catalog.SearchTarget(e,f,b),d,a)};obips.catalog.ExtendedAttrLevel=function(){};obips.catalog.ExtendedAttrLevel.NORMAL=0;obips.catalog.ExtendedAttrLevel.GREEDY=1;obips.catalog.CustomSearchDef=function(b,a){this.searchFuncId=b;this.params=a};obips.catalog.Catalog.prototype.customSearch=function(c,g,b){if(!c){throw new Error("Missing search definition.")}var f=new saw.ajax.Request("CatalogTreeModel",this._searchCB,this,{cb:b});f.addArg("action","search");f.addArg("searchfuncid",c.searchFuncId);if(c.itemInfoDetailLevel){g=c.itemInfoDetailLevel}if(g){g._addToRequestArgs(f)}if(c.params){obips.Array.forEach(c.params,function(i){f.addArg(i.name,i.value)})}f.setFatalErrorHandler(this._searchErrorCB);var h=this._sentRequest(f,b==null);if(h){var d=h.response.getJSON();var e=d.itemsinfos;var a=obips.Array.map(e,function(i){return obips.catalog.ItemInfo.parseJSON(i)});return new obips.catalog.SearchResponse(a,null,d.truncated)}};obips.catalog.Catalog.prototype._searchErrorCB=function(b,d,a){if(a.cb){var c=obips.catalog._collapseErrors(d);a.cb.exec(new obips.catalog.SearchResponse(null,c))}};obips.catalog.Catalog.prototype._searchCB=function(f,b){if(b.cb){var c=f.getJSON();var e=c.itemsinfos;var d=null;if(e){var a=null;if(b.bUseBISearch){a=obips.Array.map(e,function(g){return obips.catalog.BISearchItemInfo.parseJSON(g)});d=obips.catalog.SearchFacets.parseJSON(c.usedFacets,c.availableFacets)}else{a=obips.Array.map(e,function(g){return obips.catalog.ItemInfo.parseJSON(g)});if(b.searchCriteria&&this.cacheManager){this.cacheManager.cacheSearchResults(b.path,b.searchCriteria,b.itemInfoDetailLevel,c)}}b.cb.exec(new obips.catalog.SearchResponse(a,null,c.truncated,c.isBISearch,c.biSearchIndexUpdateDateTime,d))}else{b.cb.exec(new obips.catalog.SearchResponse(null,"Internal Server Error."))}}};obips.catalog.Catalog.prototype.getSubItems=function(d,c,b,g,e,a){var f=new obips.catalog.SearchTarget("*",false,c);f.withPermission=b;f.withPermissionMask=g;return this.searchEx(d,f,e,a)};obips.catalog.ExpandBranchResponse=function(b,a){obips.catalog.ExpandBranchResponse.baseConstructor.call(this,a);this.branch=b&&this._convert(b)};saw.extend(obips.catalog.ExpandBranchResponse,obips.catalog.AsyncResponseBase);obips.catalog.ExpandBranchResponse.prototype._convert=function(b){var c={node:obips.catalog.ItemInfo.parseJSON(b.node)};if(b.children){c.children=[];for(var a=0;a<b.children.length;a++){c.children[a]=this._convert(b.children[a])}}return c};obips.catalog.Catalog.prototype.expandBranch=function(f,l,g,a,k,e){if(f==l){var b={};b.mask="*";b.recurse=false;b.withPermission=g;b.withPermissionMask=a;var d=this.cacheManager?this.cacheManager.getItemInfo(f,false,k):null;if(d){var c=this.cacheManager?this.cacheManager.getSearchResults(f,b,k):null;if(c){var i=new obips.catalog.ExpandBranchResponse();i.branch={};i.branch.node=d;i.branch.children=[];obips.Array.forEach(c.itemInfos,function(m){i.branch.children.push({node:m})},this);if(e){setTimeout(function(){e.exec(i)},0);return null}else{return i}}}}var j=new saw.ajax.Request("CatalogTreeModel",this._expandBranchCB,this,{cb:e,path:f});j.addArg("action","lsr");j.addArg("path",f);j.addArg("upto",l);j.addArg("withperm",g);j.addArg("withpermmask",a);if(k){k._addToRequestArgs(j)}j.setFatalErrorHandler(this._expandBranchErrorCB);var h=this._sentRequest(j,e==null);if(h){return new obips.catalog.ExpandBranchResponse(h.response.getJSON())}};obips.catalog.Catalog.prototype._expandBranchErrorCB=function(b,d,a){var c=obips.catalog._collapseErrors(d);a.cb.exec(new obips.catalog.ExpandBranchResponse(null,c))};obips.catalog.Catalog.prototype._expandBranchCB=function(c,a){if(a.cb){var b=c.getJSON();a.cb.exec(new obips.catalog.ExpandBranchResponse(b))}};obips.catalog.PathStatus=function(c,a,b){this.path=c;this.status=a;this.error=b};obips.catalog.CopyMoveResponse=function(e,f,d,c,b,a){obips.catalog.CopyMoveResponse.baseConstructor.call(this,d,c);this.pending=e;this.processed=f;this.destFolder=b;this.move=a};saw.extend(obips.catalog.CopyMoveResponse,obips.catalog.ResponseWithPostProcessStatus);obips.catalog.Catalog.prototype.moveItems=function(f,e,c,b,d,a){return this._moveCopyImpl(true,f,e,c,b,d,a)};obips.catalog.Catalog.prototype.copyItems=function(f,e,c,b,d,a){return this._moveCopyImpl(false,f,e,c,b,d,a)};obips.catalog.Catalog.prototype._moveCopyImpl=function(a,e,l,j,h,i,c){var d={mv:a,paths:e,dest:l,cb:c};if(j){d.repl=j}if(h){d.acl=h}var g=new saw.ajax.Request("CatalogTreeModel",this._moveCopyCB,this,d);g.addArg("action",a?"mv":"cp");g.addArg("paths",saw.json.toString(e));g.addArg("dest",l);if(j){g.addArg("repl",j)}if(h){g.addArg("acl",h)}if(i){i._addToRequestArgs(g)}g.setFatalErrorHandler(this._moveCopyErrorCB);var f=this._sentRequest(g,c==null,true);if(f){if(f.errors){this._invalidateParents(d.paths);throw new Error(obips.catalog._collapseErrors(f.errors))}else{var k=f.response.getJSON();var b=obips.Array.map(k.processed,function(m){return obips.catalog.ItemInfo.parseJSON(m)});return new obips.catalog.CopyMoveResponse(k.pending,null,k.postProcessStatus,null,d.dest,d.mv)}}};obips.catalog.Catalog.prototype._invalidateParents=function(e){var d={};for(var a=0;a!=e.length;++a){d[obips.catalog.Path.getParentPath(e[a])]=1}var c=[];for(path in d){c.push(path)}this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEMS_INVALIDATED,c));if(this.hasListenerForEvent(obips.catalog.EventType.ITEM_INVALIDATED)){var b=this;obips.Array.forEach(c,function(f){b.notify(new obips.Observable.Event(obips.catalog.EventType.ITEM_INVALIDATED,f))})}};obips.catalog.Catalog.prototype._moveCopyErrorCB=function(b,d,a){this._invalidateParents(a.paths);var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.CopyMoveResponse(null,null,null,c,a.dest,a.mv))}else{alert(c)}};obips.catalog.Catalog.prototype._moveCopyCB=function(c,f){var c=c.getJSON();var g=c.pending;var q=f.paths;var h=[];for(var e=0;e!=q.length;++e){var a=q[e];var m=false;for(var d=0;d!=g.length;++d){if(g[d].path==a){m=true;break}}if(!m){h.push(a)}}if(c.processed.length!=0){var b=obips.Array.map(h,function(j,p){return new obips.catalog.CopyMoveEventContext(j,obips.catalog.ItemInfo.parseJSON(c.processed[p]))});var o;var k;if(f.mv){o=obips.catalog.EventType.ITEM_MOVED;k=obips.catalog.EventType.ITEMS_MOVED}else{o=obips.catalog.EventType.ITEM_COPIED;k=obips.catalog.EventType.ITEMS_COPIED}if(this.hasListenerForEvent(o)){var n=this;obips.Array.forEach(b,function(i){n.notify(new obips.Observable.Event(o,i))})}o=f.mv?obips.catalog.EventType.ITEMS_MOVED:obips.catalog.EventType.ITEMS_COPIED;this.notify(new obips.Observable.Event(o,b))}var l=c.processed;if(l.length!=0){if(l.length!=f.paths.length-g.length){}}if(f.cb){f.cb.exec(new obips.catalog.CopyMoveResponse(g,null,c.postProcessStatus,null,f.dest,f.mv))}};obips.catalog.RenameResponse=function(a,d,c,b){obips.catalog.RenameResponse.baseConstructor.call(this,c,b);this.renamed=a;this.symlink=d};saw.extend(obips.catalog.RenameResponse,obips.catalog.ResponseWithPostProcessStatus);obips.catalog.Catalog.prototype.renameItem=function(c,g,d,f,b){d=obips.catalog._resolveBoolean(d,true);var a={cb:b,cbArgs:[c,g,d],errInval:obips.catalog.Path.getParentPath(c),opName:"renameItem"};var e=new saw.ajax.Request("CatalogTreeModel",this._renameItemCB,this,a);e.addArg("action","ren");e.addArg("path",c);e.addArg("name",g);e.addArg("keepLink",d?"t":"f");if(f){f._addToRequestArgs(e)}e.setFatalErrorHandler(this._renameErrorCB);this._sentRequest(e,b==null)};obips.catalog.Catalog.prototype._renameErrorCB=function(b,d,a){this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEMS_INVALIDATED,[a.errInval]));this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEM_INVALIDATED,a.errInval));var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.RenameResponse(null,null,null,c))}else{alert(c)}};obips.catalog.Catalog.prototype._renameItemCB=function(e,a){var d=e.getJSON();var b=obips.catalog.ItemInfo.parseJSON(d.renamed);var c=new obips.catalog.RenamedEventContext(a.cbArgs[0],b);this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEM_RENAMED,c));if(d.symlink){var f=obips.catalog.ItemInfo.parseJSON(d.symlink);this.fireEvent(obips.catalog.EventType.ITEMS_CREATED,[f])}if(a.cb){a.cb.exec(new obips.catalog.RenameResponse(b,f,d.postProcessStatus))}};obips.catalog.CreateFolderResponse=function(a,b){obips.catalog.CreateFolderResponse.baseConstructor.call(this,b);this.itemInfo=a};saw.extend(obips.catalog.CreateFolderResponse,obips.catalog.AsyncResponseBase);obips.catalog.Catalog.prototype.createFolderEx=function(c,f,b,e,a){var d=new saw.ajax.Request("CatalogTreeModel",this._createFolderCB,this,{cb:a,path:c,name:f});d.addArg("action","md");d.addArg("path",c);d.addArg("name",f);if(e){e._addToRequestArgs(d)}if(b){obips.catalog.CatalogWriteHelper.parseJSON(b)._addToRequestArgs(d)}d.setFatalErrorHandler(this._createFolderErrorCB);this._sentRequest(d,a==null)};obips.catalog.Catalog.prototype.createFolder=function(b,d,c,a){this.createFolderEx(b,d,null,c,a)};obips.catalog.Catalog.prototype._createFolderErrorCB=function(b,d,a){var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.CreateFolderResponse(null,c))}};obips.catalog.Catalog.prototype._createFolderCB=function(d,b){var c=d.getJSON();var a=obips.Array.map(c,function(e){return obips.catalog.ItemInfo.parseJSON(e)});this.fireEvent(obips.catalog.EventType.ITEMS_CREATED,a);if(b.cb){b.cb.exec(new obips.catalog.CreateFolderResponse(a[a.length-1],null))}};obips.catalog.Catalog.prototype.createLink=function(f,e,d,c,a){var b=new saw.ajax.Request("CatalogTreeModel",this._createLinkCB,this,{cb:a,destPath:f,linkFolder:e,linkName:d});b.addArg("action","ln");b.addArg("src",f);b.addArg("targetPath",e);b.addArg("targetName",d);if(c){c._addToRequestArgs(b)}b.setFatalErrorHandler(this._operationCommonErrorCB);this._sentRequest(b,a==null)};obips.catalog.Catalog.prototype._createLinkCB=function(d,a){var c=d.getJSON();var b=obips.catalog.ItemInfo.parseJSON(c);this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEMS_CREATED,[b]));this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEM_CREATED,b));if(a.cb){a.cb.exec(new obips.catalog.CommonResponse(b,null))}};obips.catalog.DeleteItemsResponse=function(a,c,b){obips.catalog.DeleteItemsResponse.baseConstructor.call(this,c,b);this.statuses=a};saw.extend(obips.catalog.DeleteItemsResponse,obips.catalog.ResponseWithPostProcessStatus);obips.catalog.DeleteItemsResponse.prototype.getStatusErrorMessage=function(){return obips.catalog._getPathStatusString(this.statuses)};obips.catalog.Catalog.prototype.deleteItems=function(e,c,b){var a={paths:e,force:c||false,cb:b};var d=new saw.ajax.Request("CatalogTreeModel",this._deleteItemsCB,this,a);d.addArg("action","rm");d.addArg("paths",saw.json.toString(e));if(c){d.addArg("force","t")}d.setFatalErrorHandler(this._deleteItemsErrorCB);var f=this._sentRequest(d,b==null,true);if(f){if(f.errors){this._invalidateParents(a.paths);throw new Error(obips.catalog._collapseErrors(f.errors))}else{return new obips.catalog.DeleteItemsResponse(f.response.getJSON().pending,f.response.getJSON().postProcessStatus,null)}}};obips.catalog.Catalog.prototype._deleteItemsErrorCB=function(b,d,a){this._invalidateParents(a.paths);var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.DeleteItemsResponse(null,null,c))}else{alert(c)}};obips.catalog.Catalog.prototype._deleteItemsCB=function(c,f){var k=c.getJSON();var b=k.pending;var m=f.paths;var h=[];for(var e=0;e!=m.length;++e){var a=m[e];var l=false;for(var d=0;d!=b.length;++d){if(b[d].path==a){l=true;break}}if(!l){h.push(a)}}if(h.length!=0){var g=obips.Array.map(h,function(i){return new obips.catalog.ItemInfo(i)});this.fireEvent(obips.catalog.EventType.ITEMS_DELETED,g)}if(f.cb){f.cb.exec(new obips.catalog.DeleteItemsResponse(b,k.postProcessStatus,null))}};obips.catalog.Catalog.prototype.getItemInfo=function(c,j,i,b){var a=this.cacheManager?this.cacheManager.getItemInfo(c,j,i):null;if(a){var f=new obips.catalog.CommonResponse(a);if(b){b.exec(f);return null}else{return f}}var d={path:c,cb:b};var g=new saw.ajax.Request("CatalogTreeModel",this._getItemInfoCB,this,d);g.addArg("action","ii");g.addArg("path",c);g.addArg("followLinks",j?"t":"f");if(i){i._addToRequestArgs(g)}g.setFatalErrorHandler(this._operationCommonErrorCB);var e=this._sentRequest(g,b==null);var h=e?e.response.getJSON():null;if(h){obips.catalog.cache.seedItemInfoJSONs([h]);return new obips.catalog.CommonResponse(obips.catalog.ItemInfo.parseJSON(h))}return null};obips.catalog.Catalog.prototype.isItemExist=function(b){if(b){try{var a=this.getItemInfo(b);if(a&&!a.isError()&&a.itemInfo){return true}}catch(c){return false}}return false};obips.catalog.Catalog.prototype._getItemInfoCB=function(c,a){var b=c?obips.catalog.ItemInfo.parseJSON(c.getJSON()):null;if(a.cb){a.cb.exec(new obips.catalog.CommonResponse(b,null))}};obips.catalog.ItemInfosResponse=function(a,c,b){obips.catalog.PathDisplayPartsResponse.baseConstructor.call(this,b);this.itemInfos=a||[];this.pathErrors=c||[]};saw.extend(obips.catalog.ItemInfosResponse,obips.catalog.AsyncResponseBase);obips.catalog.ItemInfosResponse._parseJSON=function(c,d){var a=new obips.catalog.ItemInfosResponse();if(c){for(var b=0;b<d.length;b++){if(c[b].itemInfo){a.itemInfos.push(obips.catalog.ItemInfo.parseJSON(c[b].itemInfo))}else{a.pathErrors.push(new obips.catalog.PathErrorInfo(d[b],c[b].code,c[b].error))}}}return a};obips.catalog.Catalog.prototype.getItemInfos=function(e,b,d,a){if(!e||e.length<=0){return}var c=new saw.ajax.Request("CatalogTreeModel",this._getItemInfosCB,this,{paths:e,cb:a});c.addArg("action","iis");c.addArg("paths",saw.json.toString(e));c.addArg("followLinks",(b?"t":"f"));if(d){d._addToRequestArgs(c)}c.setFatalErrorHandler(this._getItemInfosErrorCB);var f=this._sentRequest(c,a==null);return f?obips.catalog.ItemInfosResponse._parseJSON(f.response.getJSON(),e):null};obips.catalog.Catalog.prototype._getItemInfosCB=function(b,a){if(a.cb){a.cb.exec(obips.catalog.ItemInfosResponse._parseJSON(b.getJSON(),a.paths))}};obips.catalog.Catalog.prototype._getItemInfosErrorCB=function(b,d,a){if(a.cb){var c=obips.catalog._collapseErrors(d);a.cb.exec(new obips.catalog.ItemInfosResponse(null,null,c))}};obips.catalog.PathDisplayPartsResponse=function(b,a,c){obips.catalog.PathDisplayPartsResponse.baseConstructor.call(this,c);this.resolved=b||[];this.unresolved=a||[]};saw.extend(obips.catalog.PathDisplayPartsResponse,obips.catalog.AsyncResponseBase);obips.catalog.PathDisplayPartsResponse.prototype.getDisplayParts=function(a){if(!this._map){this._map={};obips.Array.forEach(this.resolved,function(b){this._map[b.path]=b},this);obips.Array.forEach(this.unresolved,function(b){this._map[b.path]=b},this)}return this._map[a]&&this._map[a].parts||this._map[a]};obips.catalog.PathDisplayPartsResponse._parseJSON=function(c,d){var a=new obips.catalog.PathDisplayPartsResponse();if(c){for(var b=0;b<d.length;b++){if(c[b].parts){a.resolved.push(new obips.catalog.PathDisplayParts(d[b],c[b].parts))}else{a.unresolved.push(new obips.catalog.PathErrorInfo(d[b],c[b].code,c[b].error))}}}return a};obips.catalog.PathDisplayParts=function(b,a){this.path=b;this.parts=a};obips.catalog.Catalog.prototype.getPathDisplayParts=function(i,l,d){var e=[];var a=[];var b=[];var m={};var f=this.cacheManager;obips.Array.forEach(i,function(o){if(!m[o]){var n=f?f.getDisplayPath(o[0]):null;if(n){n.getError()?a.push(n.getError()):e.push(n.getDisplayPath())}else{b.push(o)}m[o]=true}});if(b.length==0){var h=new obips.catalog.PathDisplayPartsResponse();obips.Array.forEach(e,function(n){h.resolved.push(n)});obips.Array.forEach(a,function(n){h.unresolved.push(n)});if(d){setTimeout(function(){d.exec(h)},0);return null}else{return h}}var g={paths:b,cb:d,resolvedFromCache:e,unResolvedFromCache:a};var k=new saw.ajax.Request("CatalogTreeModel",this._getPathDisplayPartsCB,this,g);k.addArg("action","pathdisplay");k.addArg("paths",saw.json.toString(b));k.setFatalErrorHandler(this._getPathDisplayPartsErrorCB);var j=this._sentRequest(k,d==null);if(j){var c=j.response.getJSON();var h=obips.catalog.PathDisplayPartsResponse._parseJSON(c,b);if(this.cacheManager){this.cacheManager.cacheDisplayPaths(b,c);obips.Array.forEach(e,function(n){h.resolved.push(n)});obips.Array.forEach(a,function(n){h.unresolved.push(n)})}return h}return null};obips.catalog.Catalog.prototype._getPathDisplayPartsCB=function(d,a){if(a.cb){var b=d.getJSON();var c=obips.catalog.PathDisplayPartsResponse._parseJSON(b,a.paths);if(this.cacheManager){this.cacheManager.cacheDisplayPaths(a.paths,b);obips.Array.forEach(a.resolvedFromCache,function(e){c.resolved.push(e)});obips.Array.forEach(a.unResolvedFromCache,function(e){c.unresolved.push(e)})}a.cb.exec(c)}};obips.catalog.Catalog.prototype._getPathDisplayPartsErrorCB=function(b,d,a){if(a.cb){var c=obips.catalog._collapseErrors(d);a.cb.exec(new obips.catalog.PathDisplayPartsResponse(null,null,c))}};obips.catalog.SetACLResponse=function(a,c,b){obips.catalog.SetACLResponse.baseConstructor.call(this,b);this.statuses=c;this.itemInfo=a};saw.extend(obips.catalog.SetACLResponse,obips.catalog.AsyncResponseBase);obips.catalog.SetACLResponse.prototype.getStatusErrorMessage=function(){return obips.catalog._getPathStatusString(this.statuses)};obips.catalog.Catalog.prototype.setACL=function(d,b,a,i,e,h,c){var f={path:d,cb:c};var g=new saw.ajax.Request("CatalogTreeModel",this._setACLCB,this,f);g.addArg("action","setacl");g.addArg("path",d);g.addArg("acl",b.toJSONString());g.addArg("subFolders",a?"t":"f");g.addArg("folderItems",i?"t":"f");if(h){h._addToRequestArgs(g)}if(e){g.addArg("aclupdate",e)}g.setFatalErrorHandler(this._operationCommonErrorCB);this._sentRequest(g,c==null)};obips.catalog.Catalog.prototype._setACLCB=function(c,a){var c=c.getJSON();if(c){if(a.cb){var b=obips.catalog.ItemInfo.parseJSON(c.itemInfo);a.cb.exec(new obips.catalog.SetACLResponse(b,c.statuses,null))}}};obips.catalog.Catalog.prototype.setOwnership=function(d,h,c,g,f,b){var a={path:d,cb:b,recursive:g};var e=new saw.ajax.Request("CatalogTreeModel",this._setOwnershipCB,this,a);e.addArg("action","setowner");e.addArg("path",d);if(h){e.addArg("ownerguid",h);if(c){e.addArg("ownertype",c)}}e.addArg("recursive",g?"t":"f");if(f){f._addToRequestArgs(e)}e.setFatalErrorHandler(this._operationCommonErrorCB);this._sentRequest(e,b==null)};obips.catalog.Catalog.prototype._setOwnershipCB=function(b,a){if(a.recursive){this._objectsUpdatedCB(b,a)}else{this._singleObjectUpdatedCB(b,a)}};obips.catalog.Catalog.prototype.setAttributes=function(c,d,g,b,f){f=obips.catalog._resolveBoolean(f,false);var a={path:c,cb:b,recurse:f};var e=new saw.ajax.Request("CatalogTreeModel",this._setAttributesCB,this,a);e.addArg("action","setattr");e.addArg("path",c);e.addArg("attrFlags",d);e.addArg("recurse",f?"t":"f");if(g){g._addToRequestArgs(e)}e.setFatalErrorHandler(this._operationCommonErrorCB);this._sentRequest(e,b==null)};obips.catalog.Catalog.prototype._setAttributesCB=function(b,a){if(a&&a.recurse){this._objectsUpdatedCB(b,a)}else{this._singleObjectUpdatedCB(b,a)}};obips.catalog.Catalog.prototype.setProperties=function(d,c,f,b){var a={path:d,cb:b};var e=new saw.ajax.Request("CatalogTreeModel",this._setPropertiesCB,this,a);e.addArg("action","setprops");e.addArg("path",d);e.addArg("props",saw.json.toString(c));if(f){f._addToRequestArgs(e)}e.setFatalErrorHandler(this._operationCommonErrorCB);this._sentRequest(e,b==null)};obips.catalog.Catalog.prototype._setPropertiesCB=function(b,a){this._singleObjectUpdatedCB(b,a)};obips.catalog.ReadObjectResponse=function(a,c,b){obips.catalog.ReadObjectResponse.baseConstructor.call(this,b);this.itemInfo=a;this.data=c};saw.extend(obips.catalog.ReadObjectResponse,obips.catalog.AsyncResponseBase);obips.catalog.Catalog.prototype.readObject=function(c,i,h,b,a){var d={cb:b,cbArgs:[c,i],bNotifyUpdateEvent:a};var f=new saw.ajax.Request("CatalogTreeModel",this._readObjectCB,this,d);f.addArg("action","rd");f.addArg("path",c);if(typeof(i)=="undefined"||i==null){f.addArg("followLinks","t")}else{f.addArg("followLinks",i?"t":"f")}if(h){h._addToRequestArgs(f)}f.setFatalErrorHandler(this._readObjectErrorCB);var e=this._sentRequest(f,b==null);if(e){var g=e.response.getJSON();return new obips.catalog.ReadObjectResponse(obips.catalog.ItemInfo.parseJSON(g.itemInfo),g.data)}};obips.catalog.Catalog.prototype._readObjectErrorCB=function(b,d,a){var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.ReadObjectResponse(null,null,c))}else{alert(c)}};obips.catalog.Catalog.prototype._readObjectCB=function(c,a){var c=c.getJSON();var b=obips.catalog.ItemInfo.parseJSON(c.itemInfo);if(a.cb){a.cb.exec(new obips.catalog.ReadObjectResponse(b,c.data,null))}if(a.bNotifyUpdateEvent!=false){this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEMS_UPDATED,[b]));this.notify(new obips.Observable.Event(obips.catalog.EventType.ITEM_UPDATED,b))}};obips.catalog.WriteObjectResponse=function(a,b,c){obips.catalog.WriteObjectResponse.baseConstructor.call(this,b,c);this.itemInfo=a};saw.extend(obips.catalog.WriteObjectResponse,obips.catalog.AsyncResponseBase);obips.catalog.Catalog.prototype.writeObject=function(g,e,d,c,b,f,a){this._writeImpl("",g,e,d,c,b,f,a)};obips.catalog.Catalog.prototype.writeXML=function(g,d,c,b,e,f,a){e=typeof(b)=="undefined"||b==null||Boolean(e);this._writeImpl("xml",g,d,c,b,new obips.catalog.CatalogWriteHelper(e),f,a)};obips.catalog.Catalog.prototype._writeImpl=function(a,d,e,c,i,f,h,b){var g=new saw.ajax.Request("CatalogTreeModel",this._writeObjectCB,this,{data:e,cb:b});g.addArg("action","wr");g.addArg("sig",d);g.addArg("data",e);g.addArg("path",c);if(typeof(i)=="undefined"||i==null){g.addArg("followLinks","t")}else{g.addArg("followLinks",i?"t":"f")}if(f){obips.catalog.CatalogWriteHelper.parseJSON(f)._addToRequestArgs(g)}g.addArg("fmt",a);if(h){h._addToRequestArgs(g)}g.setFatalErrorHandler(this._writeObjectErrorCB);this._sentRequest(g,b==null)};obips.catalog.Catalog.prototype._writeObjectErrorCB=function(b,d,a){var c=obips.catalog._collapseErrors(d);if(a.cb){a.cb.exec(new obips.catalog.WriteObjectResponse(null,c))}};obips.catalog.Catalog.prototype._writeObjectCB=function(g,a){var h=g.getBlockById("error");if(h){h=h.data;var d=new obips.catalog.WriteObjectResponse(obips.catalog.ItemInfo.parseJSON(h.itemInfo),h.errorMsg,h.returnCode)}else{var c=g.getJSON().createdFolders;if(c&&c.length>0){this.fireEvent(obips.catalog.EventType.ITEMS_CREATED,obips.Array.map(c,function(i){return obips.catalog.ItemInfo.parseJSON(i)}))}var e=g.getJSON().itemInfo;var b=obips.catalog.ItemInfo.parseJSON(e);var f=b.created==b.lastModified?obips.catalog.EventType.ITEM_CREATED:obips.catalog.EventType.ITEM_UPDATED;this.fireEvent(f,b);var d=new obips.catalog.WriteObjectResponse(b)}if(a.cb){a.cb.exec(d)}};obips.catalog.cache.seedItemInfoJSONs=function(a){var b=obips.catalog.Catalog.getSingleton().cacheManager;if(b){b.cacheItemInfos(obips.Array.map(a,function(c){return obips.catalog.ItemInfo.parseJSON(c)}))}};obips.catalog.cache.clearCache=function(){var a=obips.catalog.Catalog.getSingleton().cacheManager;if(a){a.itemInfoCache={};a.objectCache={};a.searchResultCache={};a.displayPathCache={}}};obips.catalog.cache.Manager=function(){this.itemInfoCache={};this.objectCache={};this.searchResultCache={};this.displayPathCache={}};obips.catalog.cache.Manager.prototype.removeExpired=function(){for(key in this.itemInfoCache){if(this.itemInfoCache[key]&&this.itemInfoCache[key].isExpired()){delete this.itemInfoCache[key]}}for(key in this.objectCache){if(this.objectCache[key]&&this.objectCache[key].isExpired()){delete this.objectCache[key]}}for(key in this.searchResultCache){if(this.searchResultCache[key]&&this.searchResultCache[key].isExpired()){delete this.searchResultCache[key]}}for(key in this.displayPathCache){if(this.displayPathCache[key]&&this.displayPathCache[key].isExpired()){delete this.displayPathCache[key]}}};obips.catalog.cache.Manager.prototype.invalidateCache=function(b){if(!b){return null}var a=b.context;switch(b.type){case obips.catalog.EventType.ITEMS_DELETED:case obips.catalog.EventType.ITEMS_INVALIDATED:case obips.catalog.EventType.ITEMS_UPDATED:case obips.catalog.EventType.ITEMS_CREATED:obips.Array.forEach(a,function(c){this.removeSearchResultsCache(c.path);this.removeItemInfoCache(c.path,c.getFolderType())},this);break;case obips.catalog.EventType.ITEMS_MOVED:case obips.catalog.EventType.ITEMS_COPIED:obips.Array.forEach(a,function(c){this.removeSearchResultsCache(c.srcPath);this.removeItemInfoCache(c.srcPath,c.destItemInfo.getFolderType());this.removeSearchResultsCache(c.destItemInfo.path)},this);break;case obips.catalog.EventType.ITEM_RENAMED:this.removeSearchResultsCache(a.srcPath);this.removeItemInfoCache(a.srcPath,a.destItemInfo.getFolderType());break;default:break}};obips.catalog.cache.Manager.prototype.cacheItemInfos=function(b,a,c){obips.Array.forEach(b,function(d){this.itemInfoCache[d.path]=new obips.catalog.cache.ItemInfo(d,a,c)},this)};obips.catalog.cache.Manager.prototype.getItemInfo=function(c,b,d){var a=this.itemInfoCache[c];if(a&&!a.getError()){if(a.isExpired()){delete this.itemInfoCache[c];return null}if((b&&!a.linksResolved)){return null}if(d){if(d.extendedAttrLevel&&!a.itemInfoDetailLevel.extendedAttrLevel){return null}if(d.aclDetailLevel&&!a.itemInfoDetailLevel.aclDetailLevel){return null}}return a.getItemInfo()}return null};obips.catalog.cache.Manager.prototype.cacheSearchResults=function(c,h,g,d){var f=d.itemsinfos;var a=obips.Array.map(f,function(i){return obips.catalog.ItemInfo.parseJSON(i)});var e=this.getSearchKey(c,h);var b=new obips.catalog.cache.SearchItemInfos(a,d.truncated);b.searchCriteria=h;b.itemInfoDetailLevel=g;b.linksResolved=h.resolveLinks;b.path=c;this.searchResultCache[e]=b;this.cacheItemInfos(a,h.resolveLinks,g)};obips.catalog.cache.Manager.prototype.getSearchResults=function(b,e,d){var c=this.getSearchKey(b,e);var a=this.searchResultCache[c];if(a&&!a.getError()){if(a.isExpired()){delete this.searchResultCache[c];return null}if((e.resolveLinks&&!a.linksResolved)){return null}if(d){if(d.extendedAttrLevel&&!a.itemInfoDetailLevel.extendedAttrLevel){return null}if(d.aclDetailLevel&&!a.itemInfoDetailLevel.aclDetailLevel){return null}}return{itemInfos:a.getSearchItems(),truncated:a.isTruncated}}return null};obips.catalog.cache.Manager.prototype.getSearchKey=function(a,c){var b=null;if(c){b=c.mask+"_"+c.recurse;b=c.signatures?b+"_"+c.signatures:b;b=c.compositeSignatures?b+"_"+c.compositeSignatures:b;b=b+"_"+c.withPermission+"_"+c.withPermissionMask}return a+"_"+b};obips.catalog.cache.Manager.prototype.removeSearchResultsCache=function(a){for(var c in this.searchResultCache){var b=this.searchResultCache[c];if(b){if(b.isExpired()){delete this.searchResultCache[c];continue}if(b.path==a){delete this.searchResultCache[c];continue}var d=obips.catalog.Path.getParentPath(a);while(d!=""){if(b.path==d){delete this.searchResultCache[c];break}d=obips.catalog.Path.getParentPath(d)}}}};obips.catalog.cache.Manager.prototype.removeItemInfoCache=function(a,b){if(b){for(key in this.itemInfoCache){if(this.itemInfoCache[key]){if((key.indexOf(a+"/")==0)||this.itemInfoCache[key].isExpired()){delete this.itemInfoCache[key]}}}}else{if(this.itemInfoCache[a]){delete this.itemInfoCache[a]}}this.removeDisplayPathCache(a)};obips.catalog.cache.Manager.prototype.cacheDisplayPaths=function(c,b){if(b){for(var a=0;a<c.length;a++){if(b[a].parts){this.displayPathCache[c[a]]=new obips.catalog.cache.DisplayPath(new obips.catalog.PathDisplayParts(c[a],b[a].parts),c[a])}else{this.displayPathCache[c[a]]=new obips.catalog.cache.DisplayPath(null,new obips.catalog.PathErrorInfo(c[a],b[a].code,b[a].error),c[a])}}}};obips.catalog.cache.Manager.prototype.removeDisplayPathCache=function(a){if(this.displayPathCache[a]){delete this.displayPathCache[a]}};obips.catalog.cache.Manager.prototype.getDisplayPath=function(a){return this.displayPathCache[a]};obips.catalog.cache.Manager.prototype.cacheObjectContent=function(a){};obips.catalog.cache.Item=function(b,a){this.timestemp=new Date();this.error=a;this.itemInfoDetailLevel=b;this.linksResolved=false};obips.catalog.cache.Item.prototype.isExpired=function(){var b=obips.ResourceManager.getSingleton().getGDExpression("catalog/privileges.xml","catalogManagerCacheMaxAgeSeconds").value;var a=(b*1000);var c=new Date();if((c.getTime()-this.timestemp.getTime())>a){return true}return false};obips.catalog.cache.Item.prototype.getError=function(){return this.error};obips.catalog.cache.ItemInfo=function(a,c,d,b){obips.catalog.cache.ItemInfo.baseConstructor.call(this,c,b);this.itemInfo=a;this.linksResolved=d};saw.extend(obips.catalog.cache.ItemInfo,obips.catalog.cache.Item);obips.catalog.cache.ItemInfo.prototype.getItemInfo=function(){return this.itemInfo};obips.catalog.cache.DisplayPath=function(b,a){obips.catalog.cache.DisplayPath.baseConstructor.call(this,a);this.displayPath=b};saw.extend(obips.catalog.cache.DisplayPath,obips.catalog.cache.Item);obips.catalog.cache.DisplayPath.prototype.getDisplayPath=function(){return this.displayPath};obips.catalog.cache.SearchItemInfos=function(b,a,d,c){obips.catalog.cache.SearchItemInfos.baseConstructor.call(this,d,c);this.itemInfos=b;this.isTruncated=a;this.searchCriteria=null;this.path=null};saw.extend(obips.catalog.cache.SearchItemInfos,obips.catalog.cache.Item);obips.catalog.cache.SearchItemInfos.prototype.getSearchItems=function(){return this.itemInfos};obips.catalog.cache.ObjectContent=function(a,d,c,b){obips.catalog.cache.ObjectContent.baseConstructor.call(this,c,b);this.objectContent=null};saw.extend(obips.catalog.cache.ObjectContent,obips.catalog.cache.Item);obips.catalog.cache.ObjectContent.prototype.getObjectContent=function(){return this.objectContent}};