if(!saw.catalog.CatalogManagerHelper){saw.catalog.CatalogManagerHelper=function(b,a){this.webCatalogManager=saw.catalog.getCatalogManager();this.setWriteHelper(a);this.setItemInfoDetailLevel(b)};saw.catalog.CatalogManagerHelper.prototype.setWriteHelper=function(a){this.writeHelper=(a&&obips.catalog.CatalogWriteHelper.parseJSON(a))||new obips.catalog.CatalogWriteHelper();return this};saw.catalog.CatalogManagerHelper.prototype.setItemInfoDetailLevel=function(a){this.itemInfoDetailLevel=a;return this};saw.catalog.CatalogManagerHelper.prototype.getItemInfoDetailLevel=function(){return this.itemInfoDetailLevel};saw.catalog.CatalogManagerHelper.prototype.setOverwrite=function(a){if(a){this.writeHelper.overwrite=true}return this};saw.catalog.CatalogManagerHelper.prototype._showPostProcessMessage=function(a){var b=a.getPostProcessMessage();if(b){saw.catalog.showError(b)}};saw.catalog.CatalogManagerHelper.prototype.saveObject=function(i,d,e,b,g,j,a,h){if(j&&b){this.writeObject(i,d,e,b,g,j,h);return}this.saveObjectContext=new saw.catalog.CatalogManagerHelper.WriteObjectContext(i,d,e,b,g,h);var i=new obips.Callback(this,this._saveDialogOKButtonHandler);var c=new saw.catalog.FavoritesList(saw.catalog.FavoritesList.getDefaultFavoritesList(true));var f=new saw.catalog.SaveDialogModel(null,i,b&&obips.catalog.Path.getParentPath(b),b&&obips.catalog.Path.getItemName(b),null,c);f.setExpectedSignature(d);f.description=g;this.saveDialogViewer=new saw.catalog.SaveDialogViewer(f,a);return this.saveDialogViewer};saw.catalog.CatalogManagerHelper.prototype._saveDialogOKButtonHandler=function(b){var c=new obips.Callback(this,this._writeWithDialogOpenCB);var a=b.getPath();if(a!=this.saveObjectContext.path){this.writeHelper.expectedLastModified=null}if(b.overwrite){this.overwriteItemInfo=b.getSelectedItemInfo()}this.writeObject(c,this.saveObjectContext.signature,this.saveObjectContext.content,a,b.description,b.overwrite,this.saveObjectContext.cbCtx)};saw.catalog.CatalogManagerHelper.prototype._writeWithDialogOpenCB=function(b,a){this.saveDialogViewer.closeDialog();this.saveObjectContext.callback.exec(b,a)};saw.catalog.CatalogManagerHelper.prototype.writeObject=function(h,f,d,c,g,e,a){this.writeObjectContext=new saw.catalog.CatalogManagerHelper.WriteObjectContext(h,f,d,c,g,a);this.setOverwrite(e);this.writeHelper.setDescription(g);var b=new obips.Callback(this,this._writeObjectCB);this.webCatalogManager.writeObject(f,d,c,true,this.writeHelper,this.itemInfoDetailLevel,b)};saw.catalog.CatalogManagerHelper.WriteObjectContext=function(f,d,c,b,e,a){this.callback=f;this.cbCtx=a;this.signature=d;this.content=c;this.path=b;this.description=e};saw.catalog.CatalogManagerHelper.prototype._writeObjectCB=function(d){if(d.isError()){var a=d.getReturnCode();if(a==obips.catalog.ReturnCode.ERROR_ITEM_ALREADY_EXISTS||a==obips.catalog.ReturnCode.ERROR_ITEM_MORE_RECENT){var c=a==obips.catalog.ReturnCode.ERROR_ITEM_MORE_RECENT;var e=d.itemInfo;saw.catalog.showConfirmDialog(saw.catalog.getLocalizedString("kmsgCatalogConfirmOverwriteDlgTitle"),saw.catalog.getLocalizedString(c?"kmsgCatalogConfirmOverwriteModified":"kmsgCatalogConfirmOverwriteDlgMessage",e.caption,saw.catalog.getItemTypeName(e),e.lastModifiedDisplay),new obips.Callback(this,this._writeObjectOverwriteConfirmed),null,c);this.overwriteItemInfo=e;return}else{var b=d.getErrorMessage();if(this.overwriteItemInfo){b=saw.catalog.getLocalizedString("kmsgCatalogSaveOverwriteFailed",this.overwriteItemInfo.caption)+"\\n"+b}saw.catalog.showError(b);this.overwriteItemInfo=null}}if(this.writeObjectContext.callback){this.writeObjectContext.callback.exec(d,this.writeObjectContext.cbCtx)}};saw.catalog.CatalogManagerHelper.prototype._writeObjectOverwriteConfirmed=function(a,b){if(b){this.writeHelper.expectedLastModified=null}this.writeObject(this.writeObjectContext.callback,this.writeObjectContext.signature,this.writeObjectContext.content,this.writeObjectContext.path,this.writeObjectContext.description,true,this.writeObjectContext.cbCtx)};saw.catalog.CatalogManagerHelper.hasObjects=function(b){for(var a=0;a<b.length;a++){if(b[a].getFolderType()!=obips.catalog.FolderType.FOLDER){return true}}return false};saw.catalog.CatalogManagerHelper.prototype.copyItems=function(a,b){this._moveCopyItems(a,b)};saw.catalog.CatalogManagerHelper.prototype.moveItems=function(a,b){this._moveCopyItems(a,b,true)};saw.catalog.CatalogManagerHelper.prototype._moveCopyItems=function(b,e,a){if(e=="/shared"&&saw.catalog.CatalogManagerHelper.hasObjects(b)){saw.catalog.showError(saw.catalog.getLocalizedString("kmsgFoldersOnlyInShared"));return}var d=obips.Array.map(b,function(f){return f.path});var c=a?this.webCatalogManager.moveItems:this.webCatalogManager.copyItems;c.call(this.webCatalogManager,d,e,null,null,this.getItemInfoDetailLevel(),new obips.Callback(this,this._moveCopyItemsCB))};saw.catalog.CatalogManagerHelper.prototype._moveCopyItemsCB=function(h){if(h.getErrorMessage()){saw.catalog.showError(h.getErrorMessage())}else{var e=h.pending;var d="";for(var c=0;c<e.length;c++){if(e[c].status==obips.catalog.StatusCode.OTHER_ERROR||e[c].status==obips.catalog.StatusCode.FOLDER_ONLY_IN_SHARED){d+=e[c].error+"\n"}}if(d){saw.catalog.showError(d)}else{var b=new Array;for(var c=0;c<e.length;c++){if(e[c].status==obips.catalog.StatusCode.ITEM_ALREADY_EXISTS){b.push(e[c].path)}}if(b.length>0){var g=obips.Array.map(saw.catalog.getCatalogDisplayPaths(b),function(i){return saw.getItemName(i)});var a=this;if(h.move){var f=function(){a.webCatalogManager.moveItems(b,h.destFolder,obips.catalog.ReplaceFlags.REPLACE_ALL,null,a.getItemInfoDetailLevel(),new obips.Callback(a,a._moveCopyItemsCB))}}else{var f=function(){a.webCatalogManager.copyItems(b,h.destFolder,obips.catalog.ReplaceFlags.REPLACE_ALL,null,a.getItemInfoDetailLevel(),new obips.Callback(a,a._moveCopyItemsCB))}}saw.catalog.showConfirmDialog(saw.catalog.getLocalizedString("kmsgCatalogConfirmOverwriteDlgTitle"),saw.catalog.getLocalizedString("kmsgCatalogConfirmOverwriteDlgMessage",g.join(",")),new obips.Callback(null,f))}}}this._showPostProcessMessage(h)};saw.catalog.CatalogManagerHelper.prototype.copyToClipboard=function(a){globalRegister.addObject("clipboard",new obips.Clipboard.Clip(false,a))};saw.catalog.CatalogManagerHelper.prototype.pasteItems=function(c){var a=globalRegister.getObject("clipboard");if(a&&a.object){var b=a.object;if(a.wasCut){globalRegister.addObject("clipboard",null);this.moveItems(b,c)}else{this.copyItems(b,c)}}};saw.catalog.CatalogManagerHelper.prototype.deleteItems=function(g,k){if(!k){var e=obips.Array.map(g.slice(0,5),function(i){return'"'+i.caption+'"'});var h=obips.Array.map(g,function(i){return i.path});var c=e.join(saw.catalog.getLocalizedString("kmsgCatalogItemNameListSeparator"));if(g.length>5){c+=saw.catalog.getLocalizedString("kmsgCatalogItemNameListEtc")}var m=this;var d="";var j=false;var b=false;var a="";for(var f=0;f<g.length;f++){if(g[f].getFolderType()){j=true}if(g[f].hasSystemAttribute()){b=true;a=(a==""?a:(a+", "))+g[f].caption}}if(b){d=a.indexOf(",")>0?saw.catalog.getLocalizedString("kmsgCatalogConfirmDeleteSystemFilesMessage"):saw.catalog.getLocalizedString("kmsgCatalogConfirmDeleteSystemFileMessage",a)}else{if(j){d=saw.catalog.getLocalizedString("kmsgCatalogConfirmDeleteChildDlgMessage",c)}else{d=saw.catalog.getLocalizedString("kmsgCatalogConfirmDeleteDlgMessage",c)}}saw.catalog.showConfirmDialog(saw.catalog.getLocalizedString("kmsgCatalogConfirmDeleteDlgTitle"),d,new obips.Callback(null,function(){m.deleteItems(g,true)}))}else{var l=obips.Array.map(g,function(i){return i.path});this.webCatalogManager.deleteItems(l,false,new obips.Callback(this,this._deleteItemsCB))}};saw.catalog.CatalogManagerHelper.prototype._deleteItemsCB=function(a){if(a.getErrorMessage()){saw.catalog.showError(a.getErrorMessage())}else{if(a.statuses){var e=a.statuses;var d=a.getStatusErrorMessage();if(d){saw.catalog.showError(d)}else{var f=new Array;for(var c=0;c<e.length;c++){if(e[c].status==obips.catalog.StatusCode.CONFIRM_FORCE_DELETE){f.push(e[c].path)}}if(f.length>0){var b=this;saw.catalog.showConfirmDialog(saw.catalog.getLocalizedString("kmsgCatalogConfirmForceDeleteDlgTitle"),saw.catalog.getLocalizedString("kmsgCatalogConfirmForceDeleteDlgMessage",f.join(saw.catalog.getLocalizedString("kmsgCatalogItemNameListSeparator"))),new obips.Callback(null,function(){b.webCatalogManager.deleteItems(f,true,new obips.Callback(b,b._deleteItemsCB))}))}}}}this._showPostProcessMessage(a)};saw.catalog.NewFolderDialogModel=function(d,b,a,c){saw.catalog.NewFolderDialogModel.baseConstructor.call(this,saw.catalog.getLocalizedString("kmsgCatalogNewFolder"),d);this.name=b?b:"";this.itemsInCurrentFolder=c;this.currentFolderPath=a};saw.extend(saw.catalog.NewFolderDialogModel,obips.Dialog.Model);saw.catalog.NewFolderDialogViewer=function(b){saw.catalog.NewFolderDialogViewer.baseConstructor.call(this,b,obips.FloatingWindow.Manager.getSingleton());this.controller=new obips.Dialog.Controller(this);this.controller.updateModel=function(){this.viewer.model.name=this.viewer.nameInput.value};var a=this;this.controller.validateDialog=function(){if(!a.nameInput){return false}if(a.nameInput.value.length<1||a.nameInput.value.replace(/ /g,"").length<1){saw.catalog.showError(saw.catalog.getLocalizedString("kmsgCatalogInvalidFolderName"));return false}var e=a.getNameLimit();if(a.nameInput.value.length>e){saw.catalog.showError(saw.catalog.getLocalizedString("kmsgCatalogExceedingNameMaxLength",e));return false}var f=a.model.itemsInCurrentFolder;if(f){for(var g=0;g<f.length;g++){if(f[g].path==a.model.currentFolderPath+"/"+saw.trim(a.nameInput.value)){saw.catalog.showError(saw.catalog.getLocalizedString("kmsgCatalogCannotOverwriteDlgMessage",f[g].path));return false}}}return true};var d=saw.createChildElement(this.bodyDiv,"div");d.style.overflow="auto";var c=saw.createTable(1,2,d);c.rows[0].cells[0].appendChild(document.createTextNode(saw.catalog.getLocalizedString("kmsgCatalogDialogItemName")));c.rows[0].cells[0].className="masterPrompt XUIPromptCaption";c.rows[0].cells[1].className="XUIPromptEntry";this.nameInput=saw.createChildElement(c.rows[0].cells[1],"input","CatalogRenameItemName");this.nameInput.type="text";this.nameInput.value=this.model.name;this.floatingWindowManager.display(this);this.nameInput.focus();var a=this;this.nameInput.onkeyup=function(){a.nameInputChangedHandler()};this.nameInput.onmouseout=function(){a.nameInputChangedHandler()}};saw.extend(saw.catalog.NewFolderDialogViewer,obips.Dialog.Viewer);saw.catalog.NewFolderDialogViewer.prototype.getNameLimit=function(){return obips.catalog.Catalog.getPropertyLimit(obips.catalog.ItemProperty.NameLimit)};saw.catalog.NewFolderDialogViewer.prototype.nameInputChangedHandler=function(){};saw.catalog.CatalogManagerHelper.prototype.createFolder=function(a,b,c){this.callback=c;if(a&&b){this.webCatalogManager.createFolderEx(a,b,this.writeHelper,this.getItemInfoDetailLevel(),new obips.Callback(this,this._createNewFolderErrorHanlder))}};saw.catalog.CatalogManagerHelper.prototype._createNewFolderErrorHanlder=function(b){if(this.callback){this.callback.exec(b)}else{var a=b.getErrorMessage();if(a){saw.catalog.showError(a)}}};saw.catalog.RenameDialogModel=function(d,e,c,a,b){saw.catalog.RenameDialogModel.baseConstructor.call(this,saw.catalog.getLocalizedString("kmsgCatalogRenameDialogTitle"),e,saw.catalog.getResUrl("itemRenameDialogHelp"));this.srcPath=d;this.name=c;this.keepRef=false;this.desc=a;this.hideKnownExtensions=saw.catalog.getPrivilege("hideKnownObjectExtensions");if(b&&b.charAt(0)!="."){b="."+b}this.extension=b};saw.extend(saw.catalog.RenameDialogModel,obips.Dialog.Model);saw.catalog.RenameDialogModel.prototype._handleExtension=function(b){var a=this.extension;if(a&&this.hideKnownExtensions){if(b.length<a.length||(b.indexOf(a)!=b.length-a.length)){b+=a}}return b};saw.catalog.RenameDialogViewer=function(b){saw.catalog.RenameDialogViewer.baseConstructor.call(this,b,obips.FloatingWindow.Manager.getSingleton());this.controller=new obips.Dialog.Controller(this);this.controller.updateModel=function(){var i=this.viewer;var h=i.model;h.name=h._handleExtension(i.nameInput.value);h.keepRef=i.keepReferenceCheckbox.checked};this.controller.validateDialog=function(){var j=this.viewer;var k=j.model._handleExtension(j.nameInput.value);var h=j.getNameLimit();if(k.length>h){saw.catalog.showError(saw.catalog.getLocalizedString("kmsgCatalogExceedingNameMaxLength",h));return false}var i=j.model.extension;if(!j.model.hideKnownExtensions&&!j.bExtChangeConfirmed&&i&&k.substring(k.length-i.length)!=i){saw.catalog.showConfirmDialog(saw.catalog.getLocalizedString("kmsgCatalogConfirmRenameDlgTitle"),saw.catalog.getLocalizedString("kmsgCatalogRenameExtensionChangeWarning",i),new obips.Callback(j,j._onExtensionChangeConfirmed));return false}if(i){if(k.match(/[~!#$%\^&*+`|:"\\<>?,\/]/)){saw.catalog.showError(saw.catalog.getLocalizedString("kmsgCatalogPathInvalidChars",'~, !, #, $, %, ^, &, *, +, `, |, :, ", \\, <, >, ?, ,, /'));return false}}return true};var g=saw.createChildElement(this.bodyDiv,"div");g.style.overflow="auto";var e=saw.createTable(2,2,g);e.rows[0].cells[0].appendChild(document.createTextNode(saw.catalog.getLocalizedString("kmsgCatalogDialogItemName")));e.rows[0].cells[0].className="masterPrompt XUIPromptCaption";e.rows[0].cells[1].className="XUIPromptEntry";this.nameInput=saw.createChildElement(e.rows[0].cells[1],"input","CatalogRenameItemName");this.nameInput.type="text";var d=b.name;if(b.extension&&b.hideKnownExtensions){if(d.indexOf(b.extension)==d.length-b.extension.length){d=d.substring(0,d.length-b.extension.length)}}this.nameInput.value=d;var a=e.rows[1].cells[1];a.className="CatalogCheckboxDiv";this.keepReferenceCheckbox=saw.createInput("",null,"checkbox");a.appendChild(this.keepReferenceCheckbox);saw.createChildElement(a,"span").appendChild(document.createTextNode(saw.catalog.getLocalizedString("kmsgCatalogKeepReference")));this.nameInput.id="idRenameDialogViewer_name";this.keepReferenceCheckbox.id="idRenameDialogViewer_keepReferencesCheckbox";this.floatingWindowManager.display(this);var c=this.model.extension;var f=this.nameInput.value;if(c&&f.substring(f.length-c.length)==c){this._createSelection(this.nameInput,0,f.length-c.length)}else{this._createSelection(this.nameInput,0,f.length)}this.nameInput.focus();this.bExtChangeConfirmed=false};saw.extend(saw.catalog.RenameDialogViewer,obips.Dialog.Viewer);saw.catalog.RenameDialogViewer.prototype._createSelection=function(c,d,b){if(c.createTextRange){var a=c.createTextRange();a.collapse(true);a.moveStart("character",d);a.moveEnd("character",b);a.select()}else{if(c.setSelectionRange){c.setSelectionRange(d,b)}else{if(c.selectionStart){c.selectionStart=d;c.selectionEnd=b}}}};saw.catalog.RenameDialogViewer.prototype._onExtensionChangeConfirmed=function(){this.bExtChangeConfirmed=true;this.controller.okDialog()};saw.catalog.RenameDialogViewer.prototype.getNameLimit=function(){return obips.catalog.Catalog.getPropertyLimit(obips.catalog.ItemProperty.NameLimit)};saw.catalog.CatalogManagerHelper.prototype.renameItem=function(b){var a=this;if(b.hasSystemAttribute()){saw.catalog.showConfirmDialog(saw.catalog.getLocalizedString("kmsgCatalogConfirmRenameDlgTitle"),saw.catalog.getLocalizedString("kmsgCatalogConfirmRenameWarningMessage",b.caption),new obips.Callback(null,function(){a._renameItem(b)}))}else{this._renameItem(b)}};saw.catalog.CatalogManagerHelper.prototype._renameItem=function(c){var b=c.getObjectTypeInfo();var a=new saw.catalog.RenameDialogModel(c.path,new obips.Callback(this,this._renameDialogOKHandler),saw.getItemName(c.path),c.description,b&&b.extension);return new saw.catalog.RenameDialogViewer(a)};saw.catalog.CatalogManagerHelper.prototype._renameDialogOKHandler=function(a){if(a.name&&a.name!=saw.getItemName(a.srcPath)){this.webCatalogManager.renameItem(a.srcPath,a.name,a.keepRef,this.getItemInfoDetailLevel(),new obips.Callback(this,this._renameItemErrorCB))}};saw.catalog.CatalogManagerHelper.prototype._renameItemErrorCB=function(a){if(a.getErrorMessage()){saw.catalog.showError(a.getErrorMessage())}this._showPostProcessMessage(a)};saw.catalog.showError=function(a){saw.catalog.showMessageDialog(a,"error")};saw.catalog.showMessageDialog=function(d,g,a){if(g=="error"){var f=a||saw.catalog.getLocalizedString("kmsgCatalogErrorDialogTitle");var c=obips.MessageDialog.TITLE_IMAGE_ERROR}else{if(g=="warning"){f=a||saw.catalog.getLocalizedString("kmsgCatalogWarningDialogTitle");c=obips.MessageDialog.TITLE_IMAGE_WARNING}else{f=a||saw.catalog.getLocalizedString("kmsgCatalogInfoDialogTitle");c=obips.MessageDialog.TITLE_IMAGE_INFO}}var b=new obips.MessageDialog.Model(f,d,null,c);var e=new obips.MessageDialog.Viewer(b,obips.FloatingWindow.Manager.getSingleton())};saw.catalog.showConfirmDialog=function(h,e,b,a,c){var d=new obips.Callback(null,function(i){if(i){b.exec(i,c)}});var f=new obips.ConfirmDialog.Model(h,e,d,a);var g=new obips.ConfirmDialog.Viewer(f,obips.FloatingWindow.Manager.getSingleton(),true)}};