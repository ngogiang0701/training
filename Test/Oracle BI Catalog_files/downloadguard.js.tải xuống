if(!window.obips_downloadguard_js){obips_downloadguard_js=1;if(typeof(obips)=="undefined"){obips=function(){}}obips.DownloadGuard=function(o){if(obips.DownloadGuard.id!=0){var j=new saw.ajax.Request("DownloadGuard");j.addArg("DownloadId",obips.DownloadGuard.id);var d=new saw.ajax.createConnection(j);d.setSync(true);var h=d.post();var n=obips.XMLDOM.selectSingleNode(h.response.getXML(),"downloadGuard");if(n!=null){var b=n.getAttribute("state");if(b=="running"){var c=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadWarning").getString();var k=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadWarningTitle").getString();var f=new obips.MessageDialog.Model(k,c,null,obips.MessageDialog.TITLE_IMAGE_WARNING);var g=new obips.MessageDialog.Viewer(f,obips.FloatingWindow.Manager.getSingleton());return}}}obips.DownloadGuard.id=(new Date()).getTime()+(obips.DownloadGuard.counter++);o.id=obips.DownloadGuard.id;if(o.downloadFunc!==undefined){o.downloadFunc(o)}var l=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadBusyTitle").getString();if(l===undefined||l===null||l===""){l="Download in Progress"}var e=o.format;if(e!==undefined){e=e.toUpperCase()}var m=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadBusyMessage").getString()+e;if(m===undefined||m===null||m===""){m="Exporting "+e+"\\nTo stop Export, Click Cancel"}var i=new obips.Callback(this,obips.CancelDownloadRequest);var a=new obips.BusyDialog.Model(l,m,i,true);obips.DownloadGuard.downloadBusyViewer=new obips.BusyDialog.Viewer(a,this.floatingWindowManager);obips.DownloadStatus()};obips.DownloadStatus=function(){if(obips.DownloadGuard.id!=0){var e=new saw.ajax.Request("DownloadStatus");e.addArg("DownloadId",obips.DownloadGuard.id);e.addArg("Action","GetStatus");var b=new saw.ajax.createConnection(e);b.setSync(true);var c=b.post();var k=obips.XMLDOM.selectSingleNode(c.response.getXML(),"download");if(k!=null){var i=k.getAttribute("status");if(i===""||i==="processing"){setTimeout(function(){obips.DownloadStatus()},500);return}else{if(i==="done"){var f=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadCompletedTitle").getString();if(f===undefined||f===null||f===""){f="Download Completed"}obips.DownloadGuard.downloadBusyViewer.model.titleText=f;obips.DownloadGuard.downloadBusyViewer.model.titleImage=obips.ResourceManager.getSingleton().getURL(obips.BusyDialog.resourceFile,"uicomponents/common/title_tick.png").url;obips.DownloadGuard.downloadBusyViewer.updateTitle();var a=document.getElementById("busyImage");a.src=obips.ResourceManager.getSingleton().getURL(obips.BusyDialog.resourceFile,"master/clock_positive_finished.gif").url;var h=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadCompletedMessage").getString();if(h===undefined||h===null||h===""){h="Download Completed Successfully\\n"}obips.DownloadGuard.downloadBusyViewer.updateMessage(h);obips.DownloadGuard.downloadBusyViewer.cancelButton.style.display="none";obips.DownloadGuard.downloadBusyViewer.okButton.style.display="inline-block";return}else{if(i==="error"){var g=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadErrorTitle").getString();if(g===undefined||g===null||g===""){g="Download Error"}obips.DownloadGuard.downloadBusyViewer.model.titleText=g;obips.DownloadGuard.downloadBusyViewer.model.titleImage=obips.ResourceManager.getSingleton().getURL(obips.BusyDialog.resourceFile,"uicomponents/common/title_error.png").url;obips.DownloadGuard.downloadBusyViewer.updateTitle();var a=document.getElementById("busyImage");a.src=obips.ResourceManager.getSingleton().getURL(obips.BusyDialog.resourceFile,"uicomponents/common/title_error.png").url;a.style.display="none";var j=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadProcessingError").getString();if(j===undefined||j===null||j===""){j="Download Processing Failed!!\\n"}obips.DownloadGuard.downloadBusyViewer.updateMessage(j);obips.DownloadGuard.downloadBusyViewer.cancelButton.style.display="none";obips.DownloadGuard.downloadBusyViewer.okButton.style.display="inline-block";return}else{if(i==="canceled"){var d=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadCanceledTitle").getString();if(d===undefined||d===null||d===""){d="Download Canceled"}obips.DownloadGuard.downloadBusyViewer.updateTitle(d);obips.closeDownloadBusyDialog();var j=obips.ResourceManager.getSingleton().getResource("common/saw.common.xml","kmsgDownloadCanceled").getString();if(j===undefined||j===null||j===""){j="Download Canceled by User!!\\n"}obips.DownloadGuard.downloadBusyViewer.updateMessage(j);return}}}}}}else{obips.closeDownloadBusyDialog()}};obips.closeDownloadBusyDialog=function(){if(!obips.DownloadGuard.downloadBusyViewer.closed){var c=new saw.ajax.Request("DownloadStatus");c.addArg("DownloadId",obips.DownloadGuard.id);c.addArg("Action","ClearStatus");var b=new saw.ajax.createConnection(c);b.setSync(true);var a=b.post();window.setTimeout(function(){obips.DownloadGuard.downloadBusyViewer.closeDialog()},750);obips.DownloadGuard.downloadBusyViewer.closed=true}};obips.CancelDownloadRequest=function(){obips.closeDownloadBusyDialog();var c=new saw.ajax.Request("DownloadStatus");c.addArg("DownloadId",obips.DownloadGuard.id);c.addArg("Action","CancelDownload");var b=new saw.ajax.createConnection(c);b.setSync(true);var a=b.post()};obips.DownloadGuard.counter=0;obips.DownloadGuard.id=0};