if(!saw.list){saw.list=function(){};saw.list.Model=function(d,e,c,b){saw.list.Model.baseConstructor.call(this);this.items=d?d:[];this.sortProperty=e;this.order=c;var a=this;this.comparePropertyFunc=b?function(g,f){return b(g.content,f.content,a.sortProperty,a.order)}:function(g,f){return a.defaultComparePropertyFunc(g.content,f.content,a.sortProperty,a.order)}};extend(saw.list.Model,obips.Observable);saw.list.Model.prototype.defaultComparePropertyFunc=function(f,d,i,c){var g=f.getPropertyValue(i);var e=d.getPropertyValue(i);var h=0;if(g<e){h=-1}else{if(e<g){h=1}}if(c==saw.list.Model.SortOrder.DESCENDING){h=-h}return h};saw.list.Model.prototype.updateItem=function(a,b){this.updateItems([a],[b])};saw.list.Model.prototype.updateItems=function(c,a){for(var b=0;b<c.length;b++){c[b].content=a[b]}this.notify(new obips.Observable.Event(saw.list.Model.EventType.ITEMS_UPDATED,c))};saw.list.Model.prototype.removeItem=function(a){this.removeItems([a])};saw.list.Model.prototype.removeItems=function(b){for(var a=0;a<b.length;a++){obips.Array.remove(this.items,b[a])}this.notify(new obips.Observable.Event(saw.list.Model.EventType.ITEMS_REMOVED,b))};saw.list.Model.prototype.addItem=function(a){this.addItems([a])};saw.list.Model.prototype.addItems=function(b){for(var a=0;a<b.length;a++){b[a].hidden=this.filterFunc?!this.filterFunc(b[a].content):false;obips.Array.append(this.items,b[a],true)}this.notify(new obips.Observable.Event(saw.list.Model.EventType.SET_ITEMS,null))};saw.list.Model.prototype.setItems=function(b,a){this.items=b?b:[];if(!a){this.notify(new obips.Observable.Event(saw.list.Model.EventType.SET_ITEMS,null))}};saw.list.Model.prototype.sort=function(a){this.items.sort(a);this.notify(new obips.Observable.Event(saw.list.Model.EventType.RESORTED,null))};saw.list.Model.prototype.sortByProperty=function(b,a){this.sortProperty=b;this.order=a;this.items.sort(this.comparePropertyFunc);this.notify(new obips.Observable.Event(saw.list.Model.EventType.RESORTED,new saw.list.Model.ResortedEventContext(b,a)))};saw.list.Model.prototype.filter=function(a,c){this.filterFunc=a;if(this.filterFunc){for(var b=0;b<this.items.length;b++){this.items[b].hidden=!a(this.items[b].content)}}if(!c){this.notify(new obips.Observable.Event(saw.list.Model.EventType.FILTERED,null))}};saw.list.Model.prototype._getVisibleItemIndex=function(a){};saw.list.Model.EventType=function(){};saw.list.Model.EventType.RESORTED="resorted";saw.list.Model.EventType.FILTERED="filtered";saw.list.Model.EventType.ITEMS_REMOVED="itemsRemoved";saw.list.Model.EventType.SET_ITEMS="setItems";saw.list.Model.EventType.ITEMS_UPDATED="itemsUpdated";saw.list.Model.SortOrder=function(){};saw.list.Model.SortOrder.ASCENDING="ascendingOrder";saw.list.Model.SortOrder.DESCENDING="descendingOrder";saw.list.Model.SortOrder.NONE="noSort";saw.list.Model.SortOrder.DISABLED="disabled";saw.list.Model.ResortedEventContext=function(b,a){this.property=b;this.order=a};saw.list.ViewModel=function(b,a){saw.list.ViewModel.baseConstructor.call(this);this.selectionType=b?b:saw.list.ViewModel.SelectionType.SINGLE;this.selectedItems=a?a:[]};extend(saw.list.ViewModel,obips.Observable);saw.list.ViewModel.prototype.selectSingleItem=function(e){if(this.selectionType==saw.list.ViewModel.SelectionType.NONE){return}var b=[];for(var d=this.selectedItems.length-1;d>=0;d--){if(this.selectedItems[d]!=e){b.push(this.selectedItems[d]);this.deselectItem(this.selectedItems[d],true)}}var c=[];if(this.selectedItems.length==0){this.selectItem(e,true);c.push(e)}if(b.length>0||c.length>0){var a=new saw.list.ViewModel.EventContext.SelectionChangeEventContext(this.selectedItems,b,c);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_SELECTION_CHANGED,a))}};saw.list.ViewModel.prototype.setItemSelection=function(e){var b=new Array;for(var d=this.selectedItems.length-1;d>=0;d--){if(obips.Array.indexOf(e,this.selectedItems[d])==-1){b.push(this.selectedItems[d]);this.deselectItem(this.selectedItems[d],true)}}var c=new Array;for(d=0;d<e.length;d++){if(!this.isItemSelected(e[d])){c.push(e[d]);this.selectItem(e[d],true)}}if(b.length>0||c.length>0){var a=new saw.list.ViewModel.EventContext.SelectionChangeEventContext(this.selectedItems,b,c);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_SELECTION_CHANGED,a))}};saw.list.ViewModel.prototype.clearItemSelection=function(d){var c=this.selectedItems.slice();for(var b=this.selectedItems.length-1;b>=0;b--){this.deselectItem(this.selectedItems[b])}if(!d&&c.length>0){var a=new saw.list.ViewModel.EventContext.SelectionChangeEventContext(this.selectedItems,c,null);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_SELECTION_CHANGED,a))}};saw.list.ViewModel.prototype.deselectItem=function(d,c){var b=obips.Array.indexOf(this.selectedItems,d);if(b>-1){this.deactivateItem(d);this.selectedItems.splice(b,1);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_DESELECTED,d));if(!c){var a=new saw.list.ViewModel.EventContext.SelectionChangeEventContext(this.selectedItems,[d],null);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_SELECTION_CHANGED,a))}}};saw.list.ViewModel.prototype.selectItem=function(c,b){if(!this.isItemSelected(c)){this.selectedItems.push(c);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_SELECTED,c));if(!b){var a=new saw.list.ViewModel.EventContext.SelectionChangeEventContext(this.selectedItems,null,[c]);this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_SELECTION_CHANGED,a))}}};saw.list.ViewModel.prototype.activateItem=function(a){if(this.isItemSelected(a)&&this.activeItem!=a){if(this.activeItem){this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_DEACTIVATED,this.activeItem))}this.activeItem=a;this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_ACTIVATED,a))}};saw.list.ViewModel.prototype.deactivateItem=function(a){if(this.activeItem==a||!a){var b=a||this.activeItem;this.activeItem=null;this.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_DEACTIVATED,b))}};saw.list.ViewModel.prototype.isItemSelected=function(b){var a=false;if(this.selectionType==saw.list.ViewModel.SelectionType.SINGLE&&this.selectedItems.length>0&&this.selectedItems[0]==b){a=true}else{if(this.selectionType==saw.list.ViewModel.SelectionType.MULTIPLE&&obips.Array.indexOf(this.selectedItems,b)>-1){a=true}}return a};saw.list.ViewModel.SelectionType=function(){};saw.list.ViewModel.SelectionType.NONE="selectionDisabled";saw.list.ViewModel.SelectionType.SINGLE="singleSelection";saw.list.ViewModel.SelectionType.MULTIPLE="multiSelection";saw.list.ViewModel.EventType=function(){};saw.list.ViewModel.EventType.ITEM_SELECTED="itemSelected";saw.list.ViewModel.EventType.ITEM_DESELECTED="itemDeselected";saw.list.ViewModel.EventType.ITEM_SELECTION_CHANGED="itemSelectionChanged";saw.list.ViewModel.EventType.ITEM_ACTIVATED="itemActivated";saw.list.ViewModel.EventType.ITEM_DEACTIVATED="itemDeactivated";saw.list.ViewModel.EventType.ITEM_DOUBLE_CLICKED="itemDoubleClicked";saw.list.ViewModel.EventType.DROPPED_ON_ITEM="DroppedOnItem";saw.list.ViewModel.EventType.DRAG_ENTER_ITEM="dragEnterItem";saw.list.ViewModel.EventType.DRAG_OVER_TITEM="dragOverItem";saw.list.ViewModel.EventType.DRAG_LEAVE_ITEM="dragLeaveItem";saw.list.ViewModel.EventType.DRAG_ITEM="dragItem";saw.list.ViewModel.EventType.ITEM_CONTEXT_MENU="itemContextMenu";saw.list.ViewModel.EventContext=function(){};saw.list.ViewModel.EventContext.SelectionChangeEventContext=function(c,a,b){this.selected=c;this.removed=a;this.added=b};saw.list.ViewModel.EventContext.ContextMenuEventContext=function(b,a){this.itemModel=b;this.evt=a};saw.list.VIEW_TYPE_DETAIL="detail";saw.list.VIEW_TYPE_LIST="list";saw.list.FILL_BY_ROW="byRow";saw.list.FILL_BY_COL="byColumn";saw.list.ViewStyle=function(d,h,c,e,b,a,g,f){this.listWidth=d?d:"100%";this.viewType=h;this.rows=c;this.cols=e;this.fillOrder=b?b:saw.list.FILL_BY_COL;this.cellCSSClass=a;this.itemProperties=g;this.columnResizable=f};saw.list.ItemProperty=function(b,a,d,c){this.id=b;this.caption=a;this.hidden=c;this.width=d};saw.list.Viewer=function(d,g,f,b,e,c,a){this.model=d;this.container=g;this.viewStyle=a?a:new saw.list.ViewStyle();this.viewStyleMap=new Object;this.viewStyleMap[this.viewStyle.viewType]=this.viewStyle;this.viewModel=new saw.list.ViewModel(f,b);this.supportsDragdrop=e?true:false;this.dragdropObjClass=c?c:saw.list.DragDropObj;this.controller=new saw.list.Controller(this);this.renderItems()};saw.list.Viewer.prototype.setSelectionType=function(a){this.viewModel.selectionType=a||saw.list.ViewModel.SelectionType.SINGLE;if(this.viewModel.selectionType==saw.list.ViewModel.SelectionType.NONE){this.clearItemSelection()}else{if(this.viewModel.selectionType==saw.list.ViewModel.SelectionType.SINGLE&&this.viewModel.selectedNodes.length>1){this.selectSingleNode(this.viewModel.selectedNodes[0])}}};saw.list.Viewer.prototype.switchViewType=function(a){if(this.viewStyle.viewType!=a){if(this.getViewStyle(a)){this.viewStyle=this.getViewStyle(a)}else{this.viewStyle=clone(this.viewStyle);this.viewStyle.viewType=a;this.viewStyleMap[this.viewStyle.viewType]=this.viewStyle}this.renderItems()}};saw.list.Viewer.prototype.getViewStyle=function(a){return this.viewStyleMap[a]};saw.list.Viewer.prototype.setViewStyle=function(a,b){this.viewStyle=a;this.viewStyleMap[this.viewStyle.viewType]=this.viewStyle;if(!b){this.table.style.width=a.listWidth;this.renderItems()}};saw.list.Viewer.prototype.hideColumns=function(d,c){var e=false;var a=this.getViewStyle(saw.list.VIEW_TYPE_DETAIL);if(a){for(var b=0;b<a.itemProperties.length;b++){if(saw.arrayIndexOf(d,a.itemProperties[b].id)>=0){if(!a.itemProperties[b].hidden){e=true}a.itemProperties[b].hidden=true}}if(!c&&e&&this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){this.renderItems()}}};saw.list.Viewer.prototype.showColumns=function(d,c){var e=false;var a=this.getViewStyle(saw.list.VIEW_TYPE_DETAIL);if(a){for(var b=0;b<a.itemProperties.length;b++){if(saw.arrayIndexOf(d,a.itemProperties[b].id)>=0){if(a.itemProperties[b].hidden){e=true}a.itemProperties[b].hidden=false}}if(!c&&e&&this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){this.renderItems()}}};saw.list.Viewer.prototype.makeItemVisible=function(a){var d=this.getItemViewerByItemModel(a);if(d){var c=this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL?this.dataDiv:this.container;var b=saw.Region.getRegion(d.container);var e=saw.Region.getRegion(c);if(b.bottom<e.top){c.scrollTop-=e.top-b.top+(e.getHeight()-b.getHeight())/2}else{if(b.top>e.bottom){c.scrollTop+=b.bottom-e.bottom+(e.getHeight()-b.getHeight())/2}}if(b.right<e.left){c.scrollLeft-=e.left-b.left+(e.getWidth()-b.getWidth())/2}else{if(b.left>e.right){c.scrollLeft+=b.right-e.right+(e.getWidth()-b.getWidth())/2}}}};saw.list.Viewer.prototype._setFocusableItem=function(a){if(this.viewModel.selectionType==saw.list.ViewModel.SelectionType.NONE){return}if(this.focusableItem){var b=this.getItemViewerByItemModel(this.focusableItem);if(b){b.getFocusElement().tabIndex=-1}}if(a){this.focusableItem=a.model;a.getFocusElement().tabIndex=0}else{this.focusableItem=null}};saw.list.Viewer.prototype.renderItems=function(){saw.clearInnerHTML(this.container);this.unregisterItemDndObjects();this.table=this.container.ownerDocument.createElement("table");if(saw.getSessionInfos().isScreenReaderMode()){this.table.setAttribute("role","presentation")}this.table.cellSpacing=0;this.table.cellPadding=0;this.table.border=0;this.table.className="ListViewTable";this.table.listViewer=this;this.table.style.width=this.viewStyle.listWidth?this.viewStyle.listWidth:"100%";if(this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){this.table.className="ListDetailViewTable";this.renderDetailView();return}var n=this.getDisplayedItemNum();if(this.viewStyle.rows!=null){var m=this.viewStyle.rows;var b=Math.ceil(n/m)}else{if(this.viewStyle.cols!=null){var b=this.viewStyle.cols;var m=Math.ceil(n/b)}else{var b=1;var m=Math.ceil(n/b)}}this.rowNums=m;this.colNums=b;for(var f=0;f<m;f++){var l=this.table.insertRow(this.table.rows.length);for(var e=0;e<b;e++){var a=l.insertCell(l.cells.length);a.className="ListItem"}}var h=0;var g=null;for(var f=0;f<this.model.items.length;f++){if(this.model.filterFunc&&this.model.items[f].hidden){this.viewModel.deselectItem(this.model.items[f]);continue}if(this.viewStyle.fillOrder==saw.list.FILL_BY_ROW){var c=Math.floor(h/b);var k=h%b}else{var c=h%m;var k=Math.floor(h/m)}var d=new saw.list.ItemViewer(this,this.model.items[f],this.table.rows[c].cells[k]);g=g||d;h++}this.container.appendChild(this.table);this._setFocusableItem(this.focusableItem&&this.getItemViewerByItemModel(this.focusableItem)||g)};saw.list.Viewer.prototype.calcColumnWidth=function(a){var d=this.viewStyle.itemProperties;var c=0;for(var b=0;b<d.length;b++){if(!d.hidden){c++}}for(var b=0;b<d.length;b++){if(d[b].width==null){d[b].width=a/c+"px"}}};saw.list.Viewer.prototype.renderDetailView=function(){this.calcColumnWidth(this.container.clientWidth-20);this.columnResizeDndObjs=new Array;this.container.style.overflowY="hidden";this.container.onscroll=function(){this.listViewer.onDetailViewScroll()};this.container.listViewer=this;var h=document.createElement("table");if(saw.getSessionInfos().isScreenReaderMode()){h.setAttribute("role","presentation")}h.className="ListDetailViewHeaderContainer";this.container.insertBefore(h,this.container.firstChild);h.cellSpacing=0;h.cellPadding=0;h.border=0;var k=h.insertRow(0);var a=k.insertCell(0);a.className="ListDetailViewHeaderContainerCell";var n=k.insertCell(1);n.className="ListDetailViewHeaderPaddingCell";saw.appendTextNode(n,"\u00a0");this.headerTable=document.createElement("table");if(saw.getSessionInfos().isScreenReaderMode()){this.headerTable.setAttribute("role","presentation")}this.headerTable.cellSpacing=0;this.headerTable.cellPadding=0;this.headerTable.border=0;this.headerTable.className="ListViewTable";this.headerTable.listViewer=this;a.appendChild(this.headerTable);var k=this.headerTable.insertRow(this.table.rows.length);k.className="ListDetailViewHeader";var d=this.viewStyle.itemProperties;for(var e=0;e<d.length;e++){if(d[e].hidden){continue}var l=k.insertCell(k.cells.length);l.property=d[e].id;var m=this;l.onclick=function(i){m.controller.onColumnHeaderClicked(saw.getEvent(i));return false};l.onmouseover=function(i){m.controller.onColumnHeaderMouseover(saw.getEvent(i))};l.onmouseout=function(i){m.controller.onColumnHeaderMouseout(saw.getEvent(i))};l.onmousemove=function(i){m.controller.onColumnHeaderMousemove(saw.getEvent(i))};var b=saw.userAgent.is_nav?l:saw.createChildElement(l,"span","ListDetailViewColumnHeader");b.appendChild(document.createTextNode(d[e].caption));if(d[e].width!=null){saw.setOuterWidth(l,saw.cssLengthToInt(d[e].width))}if(this.model.sortProperty==d[e].id){var g=saw.createChildElement(b,"span","ListDetailViewSortIcon "+(this.model.order==saw.list.Model.SortOrder.ASCENDING?"ListDetailViewSortIconAsc":"ListDetailViewSortIconDesc"))}}this.dataDiv=saw.createChildElement(this.container,"div","ListDetailViewDataTableContainer");this.dataDiv.tabIndex=-1;this.dataDiv.style.height=this.container.clientHeight-h.offsetHeight+"px";this.dataDiv.appendChild(this.table);var k=this.table.insertRow(this.table.rows.length);var j=0;for(var e=0;e<d.length;e++){if(d[e].hidden){continue}if(d[e].width!=null){j+=saw.cssLengthToInt(d[e].width)}l=k.insertCell(k.cells.length);if(d[e].width!=null){saw.setOuterWidth(l,saw.cssLengthToInt(d[e].width))}}this.headerTable.style.width=j+"px";this.table.style.width=j+"px";this.headerTable.parentNode.style.width=this.headerTable.offsetWidth+"px";var f=null;for(var e=0;e<this.model.items.length;e++){if(this.model.filterFunc&&this.model.items[e].hidden){continue}var k=this.table.insertRow(this.table.rows.length);var c=new saw.list.ItemDetailViewer(this,this.model.items[e],k);f=f||c}this._setFocusableItem(this.focusableItem&&this.getItemViewerByItemModel(this.focusableItem)||f)};saw.list.Viewer.prototype.onResize=function(){if(this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){this.dataDiv.style.height=this.dataDiv.parentNode.clientHeight-this.headerTable.offsetHeight+"px";this.dataDiv.style.width=this.dataDiv.parentNode.clientWidth+"px";this.headerTable.parentNode.style.width=this.headerTable.offsetWidth+"px";this.table.parentNode.style.overflowX="hidden";this.onDetailViewScroll()}};saw.list.Viewer.prototype.onDetailViewScroll=function(){if(this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){if(this.dataDiv.parentNode){this.dataDiv.style.width=this.dataDiv.parentNode.clientWidth+this.dataDiv.parentNode.scrollLeft+"px"}}};saw.list.Viewer.prototype.getPropertyByCellIndex=function(a){var c=this.viewStyle.itemProperties;for(var b=0;b<c.length;b++){if(c[b].hidden){continue}if(a==0){return c[b]}else{a--}}return null};saw.list.Viewer.prototype.getDisplayedItemNum=function(){if(!this.model.filterFunc){return this.model.items.length}var a=0;for(var b=0;b<this.model.items.length;b++){if(!this.model.items[b].hidden){a++}}return a};saw.list.Viewer.prototype.getItemViewerByItemModel=function(a){var c=null;for(var d=0;d<this.table.rows.length;d++){var e=this.table.rows[d];if(this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){if(e.itemViewer&&e.itemViewer.model==a){return e.itemViewer}}else{for(var b=0;b<e.cells.length;b++){if(e.cells[b].itemViewer&&e.cells[b].itemViewer.model==a){c=e.cells[b].itemViewer;return c}}}}return null};saw.list.Viewer.prototype.destroy=function(){this.unregisterItemDndObjects()};saw.list.Viewer.prototype.unregisterItemDndObjects=function(){if(this.supportsDragdrop&&this.table){for(var b=0;b<this.table.rows.length;b++){var c=this.table.rows[b];for(var a=0;a<c.cells.length;a++){if(c.cells[a].itemViewer&&c.cells[a].itemViewer.dnDObj){c.cells[a].itemViewer.dnDObj.unregister()}}}}};saw.list.ItemModel=function(a){this.content=a;this.hidden=false};saw.list.ItemContent=function(){};saw.list.ItemContent.prototype.getViewer=function(b,a){};saw.list.ItemContent.prototype.getPropertyValue=function(a){return null};saw.list.ItemContent.prototype.getPropertyViewer=function(b,d){var a=document.createElement("span");a.style.whiteSpace="nowrap";var c=this.getPropertyValue(b);if(c==null){c="\u00a0"}a.appendChild(document.createTextNode(c));return a};saw.list.ItemContent.prototype.isDropTarget=function(){return false};saw.list.ItemContent.prototype.select=function(a){obips.CSS.addClassToElement(a,"masterBackgroundActive");obips.CSS.addClassToElement(a,"ListSelectedItem")};saw.list.ItemContent.prototype.deselect=function(a){obips.CSS.removeClassFromElement(a,"masterBackgroundActive");obips.CSS.removeClassFromElement(a,"ListSelectedItem")};saw.list.ItemContent.prototype.activate=function(a){obips.CSS.addClassToElement(a,"ListActiveItem")};saw.list.ItemContent.prototype.deactivate=function(a){obips.CSS.removeClassFromElement(a,"ListActiveItem")};saw.list.ItemContent.prototype.getFocusElement=function(){return null};saw.list.ItemViewer=function(f,b,e){this.model=b;this.listViewer=f;this.container=e;this.container.itemViewer=this;this.container.className="ListItem";if(this.listViewer.viewStyle.cellCSSClass){this.container.className=this.container.className+" "+this.listViewer.viewStyle.cellCSSClass}var a=this;this.container.onclick=function(g){a._clickOnItemHandler(g);return false};this.container.ondblclick=function(g){a._dblClickOnItemHandler(g);return false};this.container.oncontextmenu=function(g){a.listViewer.controller.itemContextMenuHandler(a,saw.getEvent(g))};var d=this.model.content;if(d&&d.getViewer){var c=d.getViewer(this.listViewer.viewStyle.viewType,this.container);if(c){this.container.appendChild(c)}if(this.listViewer.viewModel.selectionType!=saw.list.ViewModel.SelectionType.NONE){if(this.listViewer.viewModel.isItemSelected(this.model)){d.select(this.container);if(this.listViewer.viewModel.activeItem==this.model){d.activate(this.container)}}this.getFocusElement().tabIndex=this.listViewer.activeItem==this?0:-1;this.container.onkeyup=function(g){a._keyUpItemHandler(g);return false}}}else{this.container.appendChild(this.container.ownerDocument.createTextNode(""))}if(this.listViewer.supportsDragdrop){this.dnDObj=new this.listViewer.dragdropObjClass(this)}};saw.list.ItemViewer.prototype.getFocusElement=function(){return this.model.content.getFocusElement()||this.container};saw.list.ItemViewer.prototype.focus=function(){this.listViewer._setFocusableItem(this);this.getFocusElement().focus()};saw.list.ItemViewer.prototype._clickOnItemHandler=function(a){this.listViewer.controller.clickOnItemHandler(this,a)};saw.list.ItemViewer.prototype._dblClickOnItemHandler=function(a){this.listViewer.controller.dblClickOnItemHandler(this,a)};saw.list.ItemViewer.prototype._keyUpItemHandler=function(b){b=saw.getEvent(b);if(b.keyCode==32){this._clickOnItemHandler(b);saw.stopEvent(b)}else{if(b.keyCode==13){this._clickOnItemHandler(b);this._dblClickOnItemHandler(b);saw.stopEvent(b)}else{if(b.keyCode>=37&&b.keyCode<=40){var a=this.listViewer._findAdjacentItemViewer(this,b.keyCode);if(a){a.focus()}}}}};saw.list.Viewer.prototype._findAdjacentItemViewer=function(c,e){if(this.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){var d=null;if(e<=38){d=saw.getPreviousSiblingElement(c.container)}else{d=saw.getNextSiblingElement(c.container)}return d&&d.itemViewer}var f=c.container;var a=null;if(e==37){a=saw.getPreviousSiblingElement(f);if(!a){var d=saw.getPreviousSiblingElement(f.parentNode);a=d&&saw.getLastChildElement(d)}}else{if(e==39){a=saw.getNextSiblingElement(f);if(!a){d=saw.getNextSiblingElement(f.parentNode);a=d&&saw.getFirstChildElement(d)}}else{if(e==38){d=saw.getPreviousSiblingElement(f.parentNode);var b=saw.getCellNumber(f.parentNode,f);if(d){a=d.cells[b]}else{if(b>0){d=f.parentNode.parentNode.rows[f.parentNode.parentNode.rows.length-1];a=d&&d.cells[b-1]}}}else{if(e==40){d=saw.getNextSiblingElement(f.parentNode);var b=saw.getCellNumber(f.parentNode,f);if(d){a=d.cells[b]}else{if(b<f.parentNode.cells.length-1){d=f.parentNode.parentNode.rows[0];a=d&&d.cells[b+1]}}}}}}return a&&a.itemViewer};saw.list.ItemViewer.prototype.highlight=function(){NQWSetHasClassName(this.container,"ListHighlightedItem",true)};saw.list.ItemViewer.prototype.removeHighlight=function(){NQWRemoveClassName(this.container,"ListHighlightedItem")};saw.list.ItemViewer.prototype.getDnDGroups=function(){if(this.model.content.getDnDGroups){return this.model.content.getDnDGroups()}return null};saw.list.ItemDetailViewer=function(b,g,a){this.model=g;this.listViewer=b;this.container=a;this.container.itemViewer=this;if(this.listViewer.viewStyle.cellCSSClass){this.container.className=this.container.className+" "+this.listViewer.viewStyle.cellCSSClass}var j=this;this.container.onclick=function(i){j._clickOnItemHandler(i);return false};this.container.ondblclick=function(i){j._dblClickOnItemHandler(i);return false};this.container.oncontextmenu=function(i){j.listViewer.controller.itemContextMenuHandler(j,saw.getEvent(i))};this.container.style.padding="0px";var e=this.model.content;var c=this.listViewer.viewStyle.itemProperties;for(var d=0;d<c.length;d++){if(c[d].hidden){continue}var h=a.insertCell(a.cells.length);h.className="ListDetailViewCell";var f=this.model.content.getPropertyViewer(c[d].id,h);if(f){h.appendChild(f)}}if(this.listViewer.viewModel.selectionType!=saw.list.ViewModel.SelectionType.NONE){if(this.listViewer.viewModel.isItemSelected(this.model)){e.select(this.container);if(this.listViewer.viewModel.activeItem==this.model){e.activate(this.container)}}this.getFocusElement().tabIndex=this.listViewer.activeItem==this?0:-1;this.container.onkeyup=function(i){j._keyUpItemHandler(i);return false}}if(this.listViewer.supportsDragdrop){this.dnDObj=new this.listViewer.dragdropObjClass(this)}};saw.extend(saw.list.ItemDetailViewer,saw.list.ItemViewer);saw.list.ItemDetailViewer.prototype.getFocusElement=function(){return this.model.content.getFocusElement()||this.container.cells[0]};saw.list.Controller=function(a){this.listViewer=a;this.listViewer.viewModel.addEventListener(new obips.Observable.EventListener(saw.list.ViewModel.EventType.ITEM_SELECTED,new obips.Callback(this,this.itemSelectedHandler)));this.listViewer.viewModel.addEventListener(new obips.Observable.EventListener(saw.list.ViewModel.EventType.ITEM_DESELECTED,new obips.Callback(this,this.itemDeselectedHandler)));this.listViewer.viewModel.addEventListener(new obips.Observable.EventListener(saw.list.ViewModel.EventType.ITEM_ACTIVATED,new obips.Callback(this,this.itemActivatedHandler)));this.listViewer.viewModel.addEventListener(new obips.Observable.EventListener(saw.list.ViewModel.EventType.ITEM_DEACTIVATED,new obips.Callback(this,this.itemDeactivatedHandler)));this.listViewer.model.addEventListener(new obips.Observable.EventListener(saw.list.Model.EventType.RESORTED,new obips.Callback(this,this.redrawItems)));this.listViewer.model.addEventListener(new obips.Observable.EventListener(saw.list.Model.EventType.FILTERED,new obips.Callback(this,this.itemsFiltereddHandler)));this.listViewer.model.addEventListener(new obips.Observable.EventListener(saw.list.Model.EventType.SET_ITEMS,new obips.Callback(this,this.redrawItems)));this.listViewer.model.addEventListener(new obips.Observable.EventListener(saw.list.Model.EventType.ITEMS_REMOVED,new obips.Callback(this,this.itemsRemovedHandler)));this.listViewer.model.addEventListener(new obips.Observable.EventListener(saw.list.Model.EventType.ITEMS_UPDATED,new obips.Callback(this,this.itemsUpdatedHandler)))};saw.list.Controller.prototype.onColumnHeaderClicked=function(b){b=saw.getEvent(b);var a=saw.getEventTarget(b);while(a.tagName!="TD"){a=a.parentNode}var d=a.property;var c=this.listViewer.model;if(c.sortProperty==d&&c.order==saw.list.Model.SortOrder.ASCENDING){c.sortByProperty(d,saw.list.Model.SortOrder.DESCENDING)}else{c.sortByProperty(d,saw.list.Model.SortOrder.ASCENDING)}};saw.list.Controller.prototype.onColumnHeaderMouseover=function(a){this.onColumnHeaderMousemove(a)};saw.list.Controller.prototype.onColumnHeaderMousemove=function(c){if(!this.listViewer.viewStyle.columnResizable){return}var b=saw.findAncestorElementOrSelf(saw.getEventTarget(c),"TD");var d=saw.getElementXY(b)[0];var a=saw.getEventPageX(c);if(a>d&&a<d+3&&b.cellIndex!=0||a<=d+b.offsetWidth&&a>d+b.offsetWidth-4){b.style.cursor="col-resize";this.listViewer.columnResizeDndObj=new saw.list.ColumnResizeDndObj(this.listViewer,b.property,b,a>=d+3)}else{b.style.cursor="default";if(this.listViewer.columnResizeDndObj){this.listViewer.columnResizeDndObj.unregister()}}};saw.list.Controller.prototype.onColumnHeaderMouseout=function(b){if(!this.listViewer.viewStyle.columnResizable){return}var a=saw.getEventTarget(b);a.style.cursor="default";if(this.listViewer.columnResizeDndObj){this.listViewer.columnResizeDndObj.unregister()}};saw.list.Controller.prototype.redrawItems=function(){this.listViewer.renderItems()};saw.list.Controller.prototype.itemsFiltereddHandler=function(a){this.listViewer.renderItems()};saw.list.Controller.prototype.itemsUpdatedHandler=function(c){var a=c.context;for(var b=0;b<a.length;b++){a[b].hidden=this.listViewer.model.filterFunc?!this.listViewer.model.filterFunc(a[b].content):false}this.listViewer.renderItems()};saw.list.Controller.prototype.itemsRemovedHandler=function(a){this.listViewer.renderItems()};saw.list.Controller.prototype.itemSelectedHandler=function(c){var a=c.context;var b=this.listViewer.getItemViewerByItemModel(a);if(b){a.content.select(b.container)}};saw.list.Controller.prototype.itemDeselectedHandler=function(c){var a=c.context;var b=this.listViewer.getItemViewerByItemModel(a);if(b){a.content.deselect(b.container)}};saw.list.Controller.prototype.itemActivatedHandler=function(c){var a=c.context;var b=this.listViewer.getItemViewerByItemModel(a);if(b){a.content.activate(b.container)}};saw.list.Controller.prototype.itemDeactivatedHandler=function(c){var a=c.context;var b=this.listViewer.getItemViewerByItemModel(a);if(b){a.content.deactivate(b.container)}};saw.list.Controller.prototype.clickOnItemHandler=function(c,g){if(!g){g=window.event}var j=this.listViewer.viewModel;var k=c.model;if(g.ctrlKey&&j.selectionType==saw.list.ViewModel.SelectionType.MULTIPLE){if(j.isItemSelected(k)){j.deselectItem(k)}else{j.selectItem(k);j.activateItem(k)}j.lastClickedItem=k}else{if(g.shiftKey&&j.selectionType==saw.list.ViewModel.SelectionType.MULTIPLE){if(j.selectedItems.length==0){j.selectSingleItem(k)}else{var f=j.selectedItems[j.selectedItems.length-1];if(j.lastClickedItem&&obips.Array.contains(this.listViewer.model.items,j.lastClickedItem)){f=j.lastClickedItem}var h=obips.Array.indexOf(this.listViewer.model.items,f);var b=obips.Array.indexOf(this.listViewer.model.items,k);if(b<h){var e=h;h=b;b=e}var a=new Array;for(var d=h;d<=b;d++){if(!this.listViewer.model.items[d].hidden){a.push(this.listViewer.model.items[d])}}j.setItemSelection(a)}j.activateItem(k)}else{j.selectSingleItem(k);j.lastClickedItem=k;j.activateItem(k)}}c.focus()};saw.list.Controller.prototype.dblClickOnItemHandler=function(c,a){a=saw.getEvent(a);var b=this.listViewer.viewModel;b.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_DOUBLE_CLICKED,c.model))};saw.list.Controller.prototype.itemContextMenuHandler=function(c,a){a=saw.getEvent(a);var b=this.listViewer.viewModel;b.selectSingleItem(c.model);b.activateItem(c.model);b.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.ITEM_CONTEXT_MENU,new saw.list.ViewModel.EventContext.ContextMenuEventContext(c.model,a)))};saw.list.Controller.prototype.canAcceptDrop=function(b,a){return true};saw.list.DragDropEventContext=function(c,b,a){this.dragSourceObj=c;this.targetItemViewer=b;this.evt=a};saw.list.DragDropObj=function(c){var a="listDefaultGroup";var d=c.getDnDGroups();if(d&&d.length>0){a=d[0]}saw.list.DragDropObj.baseConstructor.call(this,c.container,a);if(d&&d.length>1){for(var b=1;b<d.length;b++){this.addToGroup(d[b])}}this.draggingCursor="default";this.setIsTarget(false);this.borderWidth=0;this.itemViewer=c;this.draggedItems=new Array};saw.extend(saw.list.DragDropObj,saw.dnd.SimpleDragObj);saw.list.DragDropObj.prototype.setDragObjContents=function(){var a=this.getDragObj();a.style.border="none";a.style.whiteSpace="nowrap";a.style.height="auto";if(this.itemViewer.listViewer.viewModel.selectedItems.length>1&&this.itemViewer.listViewer.viewModel.isItemSelected(this.itemViewer.model)){saw.clearInnerHTML(a);saw.createChildElement(a,"span","ListDragMultiItemIcon")}else{saw.list.DragDropObj.superClass.setDragObjContents.call(this,saw.getFirstChildElement(this.getSource()))}};saw.list.DragDropObj.prototype.autoOffset=function(e,d){if(this.itemViewer.listViewer.viewModel.selectedItems.length>1&&this.itemViewer.listViewer.viewModel.isItemSelected(this.itemViewer.model)){this.setDelta(10,8)}else{var c=this.getSource();var f=saw.getElementXY(c);var a=e-f[0];var b=saw.getFirstChildElement(c);if(this.itemViewer.listViewer.viewStyle.viewType==saw.list.VIEW_TYPE_DETAIL){b=saw.getFirstChildElement(b)}if(a>b.offsetWidth){a=b.offsetWidth/2}var g=d-f[1];this.setDelta(a,g)}};saw.list.DragDropObj.prototype.isDraggable=function(a,b){if(!this.bDraggable){return false}if(this.itemViewer.model.content.isDraggable){return this.itemViewer.model.content.isDraggable(a,b)}return this.itemViewer.listViewer.supportsDragdrop};saw.list.DragDropObj.prototype.isTarget=function(){if(this.itemViewer.model.content.isDropTarget){return this.itemViewer.model.content.isDropTarget()}return this.bTarget};saw.list.DragDropObj.prototype.willAcceptDropSource=function(a){return this.itemViewer.listViewer.controller.canAcceptDrop(a,this.itemViewer)};saw.list.DragDropObj.prototype.startDrag=function(b,a,c){saw.list.DragDropObj.superClass.startDrag.call(this,b,a,c);if(this.itemViewer.listViewer.viewModel.isItemSelected(this.itemViewer.model)){this.draggedItems=this.itemViewer.listViewer.viewModel.selectedItems}else{this.draggedItems=[this.itemViewer.model]}};saw.list.DragDropObj.prototype.onDrag=function(a){saw.list.DragDropObj.superClass.onDrag.call(this,a);this.itemViewer.listViewer.viewModel.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.DRAG_ITEM,new saw.list.DragDropEventContext(this,null,a)))};saw.list.DragDropObj.prototype.onDragEnter=function(a,b){if(this.willAcceptDropSource(b)){this.itemViewer.highlight();this.itemViewer.listViewer.viewModel.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.DRAG_ENTER_ITEM,new saw.list.DragDropEventContext(b,this.itemViewer,a)))}};saw.list.DragDropObj.prototype.onDragOver=function(a,b){if(this.willAcceptDropSource(b)){this.itemViewer.listViewer.viewModel.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.DRAG_OVER_ITEM,new saw.list.DragDropEventContext(b,this.itemViewer,a)))}};saw.list.DragDropObj.prototype.onDragExit=function(a,b){if(this.willAcceptDropSource(b)){this.itemViewer.removeHighlight();this.itemViewer.listViewer.viewModel.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.DRAG_LEAVE_ITEM,new saw.list.DragDropEventContext(b,this.itemViewer,a)))}};saw.list.DragDropObj.prototype.onDragDrop=function(a,b){if(this.willAcceptDropSource(b)){this.itemViewer.removeHighlight();this.itemViewer.listViewer.viewModel.notify(new obips.Observable.Event(saw.list.ViewModel.EventType.DROPPED_ON_ITEM,new saw.list.DragDropEventContext(b,this.itemViewer,a)));return false}};saw.list.ColumnResizeDndObj=function(d,c,a,b){saw.list.ColumnResizeDndObj.baseConstructor.call(this,a,"listColumnResizeDnd"+new Date().valueOf());this.listViewer=d;this.rightEdge=b;this.bCanDropAnywhere=true;this.draggingCursor="resize";this.setIsTarget(false);this.setYConstraint(0,0)};saw.extend(saw.list.ColumnResizeDndObj,saw.dnd.SimpleDragObj);saw.list.ColumnResizeDndObj.prototype.setDragObjContents=function(){var a=this.getDragObj();saw.appendTextNode(a,"\u00a0");a.style.border="none";a.style.backgroundColor="gray";a.style.width="1px";a.style.height=this.listViewer.container.clientHeight+"px";a.style.cursor="col-resize"};saw.list.ColumnResizeDndObj.prototype.autoOffset=function(b,a){this.setDelta(0,0)};saw.list.ColumnResizeDndObj.prototype.alignObjWithMouse1=function(c,f,e,b){var d=this.getTargetCoord(f,e,b);var g=[d.x,d.y];var a=this.rightEdge?this.getSource().offsetWidth:0;saw.setElementXY(c,d.x+a,d.y);this.lastPageX=d.x;this.lastPageY=d.y};saw.list.ColumnResizeDndObj.prototype.onDragDrop=function(b){var g=saw.dnd.getEventPosToCtrlWindow(b);var f=this.getTargetCoord(g[0],g[1]);var d=f.x-saw.getElementXY(this.getSource())[0]-(this.rightEdge?this.getSource().offsetWidth:0);var a=this.rightEdge?this.getSource():saw.getPreviousSiblingElement(this.getSource());a.style.width=saw.cssLengthToInt(a.style.width)+d+"px";var c=saw.cssLengthToInt(this.listViewer.headerTable.style.width)+d+"px";this.listViewer.table.style.width=c;var e=this.listViewer.table.rows[0].cells[a.cellIndex];e.style.width=saw.cssLengthToInt(e.style.width)+d+"px";this.listViewer.headerTable.style.width=c;this.listViewer.getPropertyByCellIndex(a.cellIndex).width=e.style.width;this.listViewer.headerTable.parentNode.style.width=this.listViewer.headerTable.offsetWidth+"px";this.listViewer.dataDiv.style.overflowX="hidden";this.listViewer.dataDiv.style.height=this.listViewer.container.clientHeight-this.listViewer.headerTable.offsetHeight+"px"}};