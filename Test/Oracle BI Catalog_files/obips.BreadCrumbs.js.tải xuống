if(!obips.BreadCrumbs){obips.BreadCrumbs=function(){};obips.BreadCrumbs.StateID=function(){};obips.BreadCrumbs.StateID.BREAD_CRUMB="breadCrumb";obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM="bcOpenItem";obips.BreadCrumbs.StateID.PAGES_DELAYED_STATE="bcPagesDelayedState";obips.BreadCrumbs.resourceFile="uicomponents/obips.BreadCrumbs/breadcrumb.xml";obips.BreadCrumbs.getImgUrl=function(a){return obips.ResourceManager.getSingleton().getURL(obips.BreadCrumbs.resourceFile,a).url};obips.BreadCrumbs.Manager=function(){var a=obips.getSingleton(obips.BreadCrumbs.Manager.SINGLETON_NAME);if(a){return a}this.currentItem=null;this.breadCrumbArray=null;globalRegister.addObject(obips.BreadCrumbs.Manager.SINGLETON_NAME,this)};obips.BreadCrumbs.Manager.SINGLETON_NAME="breadCrumbManager";obips.BreadCrumbs.Manager.getSingleton=function(){var a=obips.getSingleton(obips.BreadCrumbs.Manager.SINGLETON_NAME);if(!a){a=new obips.BreadCrumbs.Manager()}return a};obips.BreadCrumbs.Manager.prototype.reset=function(){var a=saw.storage.ClientStorageManager.getSingleton();a.removeState(obips.BreadCrumbs.StateID.BREAD_CRUMB,saw.storage.StorageType.SESSION_STORAGE,true);a.removeState(obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM,saw.storage.StorageType.SESSION_STORAGE,true);a.removeState(obips.BreadCrumbs.StateID.PAGES_DELAYED_STATE,saw.storage.StorageType.SESSION_STORAGE,true);this.breadCrumbArray=null;this.currentItem=null};obips.BreadCrumbs.Manager.prototype.getBreadCrumbItems=function(){if(this.breadCrumbArray==null){this.breadCrumbArray=this._getCMSState()}return this.breadCrumbArray};obips.BreadCrumbs.Manager.prototype.getCurrentOpenItem=function(){var a=saw.storage.ClientStorageManager.getSingleton();var d=a.getState(obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM,saw.storage.StorageType.SESSION_STORAGE,true);var c=d?saw.json.parse(d):null;if(c){var b=new obips.BreadCrumbs.BreadCrumbItem();b.parseJSON(c);return b}return null};obips.BreadCrumbs.Manager.prototype._getPagesDelayedState=function(){var a=saw.storage.ClientStorageManager.getSingleton();var b=a.getState(obips.BreadCrumbs.StateID.PAGES_DELAYED_STATE,saw.storage.StorageType.SESSION_STORAGE,true);return b?saw.json.parse(b):null};obips.BreadCrumbs.Manager.prototype._addPageDelayedState=function(c,b,d){if(c&&b){var a=this._getPagesDelayedState();if((!d&&a&&a[c]&&a[c][b])||(d)){if(!a){a=new Object()}if(!a[c]){a[c]=new Object()}a[c][b]=d;this._updateCMSState(obips.BreadCrumbs.StateID.PAGES_DELAYED_STATE,a)}}};obips.BreadCrumbs.Manager.prototype.getPageDelayedState=function(d,c){if(!d){d=saw.getSessionInfos().portalPath}if(!d){var a=this.getCurrentOpenItem();d=a.path}if(!d||!c){return null}var b=this._getPagesDelayedState();if(!b||!b[d]||!b[d][c]){return null}return b[d][c]};obips.BreadCrumbs.Manager.prototype.updateDelayedStatePageName=function(d,c,b){if(d&&c&&b){var a=this._getPagesDelayedState();if(a){if(a[d]&&a[d][c]){a[d][b]=a[d][c];a[d][c]=null;this._updateCMSState(obips.BreadCrumbs.StateID.PAGES_DELAYED_STATE,a)}}}};obips.BreadCrumbs.Manager.prototype.addToBreadCrumb=function(l,d,e,g,a,c){var h=new obips.BreadCrumbs.BreadCrumbItem(l,d,e,g,c);var b=this.getCurrentOpenItem();this.breadCrumbArray=this._getCMSState();if(a){h.id=this.breadCrumbArray.length;this.breadCrumbArray.push(h)}else{var j=(g&&g.page)?true:false;var i=(b&&b.params&&b.params.page&&b.path==d&&b.editAction==h.editAction)?true:false;var f=b?b.id:-1;if(j&&i&&f!=-1&&f==this.breadCrumbArray.length-1){h.id=f;this.breadCrumbArray[f]=h}else{var k=this._getBCItemindex(this.breadCrumbArray,h);if(k!=-1){this.breadCrumbArray=this.breadCrumbArray.slice(0,k)}h.id=this.breadCrumbArray.length;this.breadCrumbArray.push(h)}}this.currentItem=h;this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM,this.currentItem);this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB,this.breadCrumbArray)};obips.BreadCrumbs.Manager.prototype.updateBreadCrumbItem=function(b){var a=this._getBCItemindex(this.breadCrumbArray,b);if(a!=-1){this.breadCrumbArray[a]=b;this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB,this.breadCrumbArray);if(a==this.breadCrumbArray.length-1){this.currentItem=b;this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM,this.currentItem)}return true}return false};obips.BreadCrumbs.Manager.prototype.updateBreadCrumbItemAtIdx=function(a,b){if(a!=-1){this.breadCrumbArray[a]=b;this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB,this.breadCrumbArray);if(a==this.breadCrumbArray.length-1){this.currentItem=b;this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM,this.currentItem)}return true}return false};obips.BreadCrumbs.Manager.prototype.replaceBreadCrumbItem=function(b,c){var a=this._getBCItemindex(this.breadCrumbArray,b);if(a!=-1){this.updateBreadCrumbItemAtIdx(a,c)}};obips.BreadCrumbs.Manager.prototype.handleClickOnBCItem=function(c){var b=this.getBreadCrumbItems();var a=this._getBCItemindex(b,c);this.breadCrumbArray=b.slice(0,a+1);this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB,this.breadCrumbArray);this.currentItem=c;this._updateCMSState(obips.BreadCrumbs.StateID.BREAD_CRUMB_OPEN_ITEM,this.currentItem)};obips.BreadCrumbs.Manager.prototype.updateDashboardPageName=function(f,d,c,g){var a=this.getBreadCrumbItems();if(a){for(var b=0;b<a.length;b++){var e=a[b];if(e.path==f&&e.params&&e.params.page&&e.params.page==d){e.caption=g;e.params.page=c;this.updateBreadCrumbItemAtIdx(b,e)}}this.showBreadCrumbs()}this.updateDelayedStatePageName(f,d,c)};obips.BreadCrumbs.Manager.prototype.showBreadCrumbs=function(d){var d=d?d:document.getElementById("BreadCrumbDiv");if(d){d.className="masterBreadCrumbDiv "+d.className;d.innerHTML="";var c=this.getBreadCrumbItems();if(c&&c.length>1&&(!saw.userAgent.is_smrtphone)){if(document.getElementById("PageContentOuterDiv")){document.getElementById("PageContentOuterDiv").style.margin="0"}d.style.display="";var a=new obips.BreadCrumbs.Model(c,this.currentItem);var b=new obips.BreadCrumbs.Viewer(a,d)}else{d.style.display="none"}}};obips.BreadCrumbs.Manager.prototype._updateCMSState=function(c,d){var a=saw.storage.ClientStorageManager.getSingleton();a.removeState(c,saw.storage.StorageType.SESSION_STORAGE,true);var b=saw.json.toString(d);a.setState(c,b,saw.storage.StorageType.SESSION_STORAGE,true)};obips.BreadCrumbs.Manager.prototype._getBCItemindex=function(e,d){var a=-1;for(var b=e.length-1;b>=0;b--){var c=e[b];if(c.equals(d)){a=b;break}}return a};obips.BreadCrumbs.Manager.prototype._getCMSState=function(){var b=saw.storage.ClientStorageManager.getSingleton();var f=b.getState(obips.BreadCrumbs.StateID.BREAD_CRUMB,saw.storage.StorageType.SESSION_STORAGE,true);var d=f?saw.json.parse(f):null;var a=new Array();for(var c=0;d!=null&&c<d.length;c++){var e=new obips.BreadCrumbs.BreadCrumbItem();e.parseJSON(d[c]);a.push(e)}return a};obips.BreadCrumbs.Manager.prototype._updateStateCB=function(g){var c=g.getJSON();if(c){var a=this.getBreadCrumbItems();for(var d=0;d<a.length;d++){var e=a[d];if(e.params&&e.params.ViewState){var b=e.params.ViewState;if(c[b]){var f=c[b];e.params.ViewState=f;this.updateBreadCrumbItemAtIdx(d,e)}}}}};obips.BreadCrumbs.Manager.prototype._updateStateErrorCB=function(b,a){return};obips.BreadCrumbs.Manager.prototype.removeObjectState=function(c,l,d,a,b,e){if(!c||!l){throw new Error("Missing Required Parameters.")}var g=null;var k=this.getBreadCrumbItems();if(k){for(var f=0;f<k.length;f++){var j=k[f];if(j.params&&j.params.ViewState&&(!b||(b&&j.params.page&&j.params.page==b))&&(!e||(e&&j.path&&j.path==e))){if(g){g=g+"~"+j.params.ViewState}else{g=j.params.ViewState}}}}if(g){var h=new saw.ajax.Request("RemoveObjectState",this._updateStateCB,this);h.setFatalErrorHandler(this._updateStateErrorCB);h.addArg("ViewState",g);h.addArg("Folder",c);h.addArg("ItemName",l);h.addArg("newFolder",d);h.addArg("newItemName",a);saw.ajax.createConnection(h).post()}};obips.BreadCrumbs.Manager.prototype._updateOnPageUnload=function(){var a=this.getCurrentOpenItem();if(a){if(a.params&&a.params.page){var d=document.getElementById("idViewStateDiv");if(d){a.params.ViewState=d.getAttribute("stateid")}if(obidash){this._addPageDelayedState(a.path,a.params.page,obidash.getCurrPageDelayedState())}}else{var d=document.getElementById("idStatePathDiv");if(d){var c=d.getAttribute("statePath");var b=obips.views.ViewController.getController(c);if(!a.params){a.params={}}a.params.ViewID=c;a.params.ViewState=b.getViewEnvParam("ViewState")}}this.updateBreadCrumbItem(a)}};obips.BreadCrumbs.Manager.prototype.addPageUnloadHandler=function(a){obips.launcher.addPageUnloadGuard(a?a:new obips.Callback(this,this._updateOnPageUnload),"")};obips.BreadCrumbs.Model=function(b,a){this.breadCrumbItems=b;this.currentItem=a};obips.BreadCrumbs.Model.prototype.getBreadCrumbItems=function(e){if(e){var d=this.breadCrumbItems[0];var a=new Array();for(var b=0;b<15;b++){var c=new obips.BreadCrumbs.BreadCrumbItem();c.caption="Test "+b+" - "+d.caption;c.parseJSON(c);a.push(c)}for(var b=0;b<this.breadCrumbItems.length;b++){a.push(this.breadCrumbItems[b])}return a}return this.breadCrumbItems};obips.BreadCrumbs.Model.prototype.getCurrentOpenItem=function(){return this.currentItem};obips.BreadCrumbs.Model.prototype.getBreadCrumbById=function(a){var b=null;for(var c=0;c<this.breadCrumbItems.length;c++){var d=this.breadCrumbItems[c];if(d.id==a){b=d;break}}return b};obips.BreadCrumbs.BreadCrumbItem=function(a,c,b,e,d){this.id=-1;this.caption=a;this.path=c;this.params=e;this.editAction=b;this.cssClassName=d};obips.BreadCrumbs.BreadCrumbItem.prototype.parseJSON=function(a){this.id=a.id;this.caption=a.caption;this.path=a.path;this.params=a.params;this.editAction=a.editAction;this.cssClassName=a.cssClassName};obips.BreadCrumbs.BreadCrumbItem.prototype.getPageName=function(){if(this.params){return this.params.page}return null};obips.BreadCrumbs.BreadCrumbItem.prototype.toString=function(){return this.path};obips.BreadCrumbs.BreadCrumbItem.prototype.equals=function(b){var a=false;if(this.id!=-1&&b.id!=-1){a=(this.id==b.id)?true:false}else{a=(b&&this.path==b.path&&this.editAction==b.editAction&&this.getPageName()==b.getPageName())?true:false}return a};obips.BreadCrumbs.BreadCrumbItem.prototype.getAdditionalUrlArguments=function(){var a="";var c=this.params;if(c){for(var d in c){var e=c[d];switch(d){case"page":break;case"PreviousPageRef":for(var b in e){a+="&"+b+"="+saw.encodeURIComponent(e[b])}break;default:a+="&"+d+"="+saw.encodeURIComponent(e);break}}}return a};obips.BreadCrumbs.Viewer=function(b,a){this.model=b;this.container=a;this.render()};obips.BreadCrumbs.Viewer.prototype.render=function(){if(!this.containingDiv){this.containingDiv=document.createElement("div")}var w=obips.BreadCrumbs.getImgUrl("obips.TabBar/l1_tabbar_start");var a=obips.BreadCrumbs.getImgUrl("overflow_g_start");if(this.breadCrumbTable){this.breadCrumbTable.parentNode.removeChild(this.breadCrumbTable)}this.breadCrumbTable=document.createElement("table");this.breadCrumbTable.width="100%";this.breadCrumbTable.cellSpacing="0px";this.breadCrumbTable.style.tableLayout="fixed";var v=document.createElement("tbody");this.breadCrumbTable.appendChild(v);var l=document.createElement("tr");v.appendChild(l);var u=document.createElement("td");var e="10px";u.style.width=e;l.appendChild(u);this.breadCrumbOverflowStartImg=document.createElement("img");this.breadCrumbOverflowStartImg.src=a;this.breadCrumbOverflowStartImg.alt="";var q=new obips.BrowserEventFramework.EventRouter(this.breadCrumbOverflowStartImg,"onmouseover");q.addEventListener(new obips.Observable.EventListener(null,new obips.Callback(this,this._mouseOverOverflowIconHandler)));var p=new obips.BrowserEventFramework.EventRouter(this.breadCrumbOverflowStartImg,"onmouseout");p.addEventListener(new obips.Observable.EventListener(null,new obips.Callback(this,this._mouseOutOverflowIconHandler)));var t=new obips.BrowserEventFramework.EventRouter(this.breadCrumbOverflowStartImg,"onmousedown");t.addEventListener(new obips.Observable.EventListener(null,new obips.Callback(this,this._mouseDownOverflowIconHandler)));var s=new obips.BrowserEventFramework.EventRouter(this.breadCrumbOverflowStartImg,"onclick");s.addEventListener(new obips.Observable.EventListener(null,new obips.Callback(this,this._clickOverflowIconHandler)));u.appendChild(this.breadCrumbOverflowStartImg);if(w!=null){u.className="masterBreadCrumbOverflowImageStart overflowImageStart";this.breadCrumbOverflowStartImg.className="masterBreadCrumbOverflow obipsBreadCrumbOverflow"}this.breadCrumbTabsCell=document.createElement("td");l.appendChild(this.breadCrumbTabsCell);this.breadCrumbDiv=document.createElement("div");this.breadCrumbDiv.style.overflow="hidden";this.breadCrumbTabsCell.appendChild(this.breadCrumbDiv);if(this.bcTable){this.bcTable.parentNode.removeChild(this.bcTable)}this.bcTable=document.createElement("table");this.bcTable.className="BreadCrumbTable";var f=document.createElement("tbody");this.bcTable.appendChild(f);var d=document.createElement("tr");f.appendChild(d);var n=this;var b=this.model.getBreadCrumbItems();var k=this.model.getCurrentOpenItem();for(var r=0;b!=null&&r<b.length;r++){var j=b[r];var g="";if(j){var x=document.createElement("td");x.className="BreadCrumbItemTd";x.id="bcitem"+r;d.appendChild(x);var h=document.createElement("span");h.id="breadCrumbSpan"+r;x.appendChild(h);if(b[r].equals(k)){h.appendChild(document.createTextNode(j.caption));g=j.editAction?"masterBreadCrumbCurrentEditItem BreadCrumbCurrentEditItem":"masterBreadCrumbCurrentItem BreadCrumbCurrentItem";h.className=g}else{g=j.editAction?"masterBreadCrumbEditItem BreadCrumbEditItem":"masterBreadCrumbItem BreadCrumbItem";var c=saw.createChildElement(h,"a",g);c.href="javascript:void(null)";c.appendChild(document.createTextNode(j.caption));c.title=j.caption;c.bcItem=j;c.onclick=this.onBreadCrumbClicked}if(r+1!=b.length){var o=document.createElement("td");o.className="masterBreadCrumbImageTd BreadCrumbImageTd";var m=document.createElement("span");m.id="imageSpan"+r;o.appendChild(m);m.appendChild(document.createTextNode(">"));d.appendChild(o)}}}this.breadCrumbDiv.appendChild(this.bcTable);if(!this.breadCrumbBodiesDiv){this.breadCrumbBodiesDiv=document.createElement("div");this.containingDiv.appendChild(this.breadCrumbBodiesDiv)}this.containingDiv.insertBefore(this.breadCrumbTable,this.breadCrumbBodiesDiv);if(this.containingDiv.parentNode==null||this.containingDiv.parentNode.tagName==null){document.getElementById("BreadCrumbDiv").appendChild(this.containingDiv)}this.updateOverflowIconsVisibility();obips.BrowserEventFramework.EventRouter.getEventRouter(window,"onresize").addEventListener(new obips.Observable.EventListener(null,new obips.Callback(this,this.updateOverflowIconsVisibility)))};obips.BreadCrumbs.Viewer.prototype._mouseOverOverflowIconHandler=function(a){if(a.target==this.breadCrumbOverflowStartImg){this.breadCrumbOverflowStartImg.src=obips.BreadCrumbs.getImgUrl("overflow_start");this.breadCrumbOverflowStartImg.alt="";this.breadCrumbOverflowStartImg.className="obipsBreadCrumbOverflowOver"}};obips.BreadCrumbs.Viewer.prototype._mouseOutOverflowIconHandler=function(a){if(a.target.src==this.breadCrumbOverflowStartImg.src){this.breadCrumbOverflowStartImg.src=obips.BreadCrumbs.getImgUrl("overflow_g_start");this.breadCrumbOverflowStartImg.alt="";this.breadCrumbOverflowStartImg.className="masterBreadCrumbOverflow obipsBreadCrumbOverflow"}};obips.BreadCrumbs.Viewer.prototype._mouseDownOverflowIconHandler=function(a){if(a.target==this.breadCrumbOverflowStartImg){this.breadCrumbOverflowStartImg.className="masterBreadCrumbOverflowDown obipsBreadCrumbOverflowDown"}};obips.BreadCrumbs.Viewer.prototype._clickOverflowIconHandler=function(k){var d=this.bcTable.offsetWidth;var a=this.breadCrumbDiv.offsetWidth;var j=0;j=d-a;var b=new Array();var m=this.model.getBreadCrumbItems();var h=0;if(k.target==this.breadCrumbOverflowStartImg){for(var c=0;c<m.length;c++){var f=m[c];var e=document.getElementById("breadCrumbSpan"+c);h+=e.offsetWidth;if(h<j){var l=this;b.push(new obips.BreadCrumbs.Viewer.OverflowMenuOption(f,new obips.Callback(l,l.onBreadCrumbClicked)))}}}var g=new obips.ContextMenu.Model(k,b);obips.ContextMenu.Manager.getSingleton().display(g,k)};obips.BreadCrumbs.Viewer.prototype.updateOverflowIconsVisibility=function(){var a=this.bcTable.offsetWidth;var b=this.breadCrumbDiv.offsetWidth;this.breadCrumbOverflowStartImg.style.display=(b<a)?"inline":"none";this.breadCrumbDiv.scrollLeft=a};obips.BreadCrumbs.Viewer.OverflowMenuOption=function(b,a){obips.BreadCrumbs.Viewer.OverflowMenuOption.baseConstructor.call(this,b.caption,b.caption,null,a,null,false);this.bcItem=b};extend(obips.BreadCrumbs.Viewer.OverflowMenuOption,obips.ContextMenu.MenuOption);obips.BreadCrumbs.Viewer.prototype.onBreadCrumbClicked=function(a){var f=null;if(a&&a.context&&a.context.menuOption){f=a.context.menuOption.bcItem}else{a=obips.BrowserEventFramework.normalizeEvent(a);f=saw.getEventTarget(a).bcItem}if(f){obips.BreadCrumbs.Manager.getSingleton().handleClickOnBCItem(f);var e=f.path;if(f.params!=null&&f.params.page!=null){e=obips.catalog.Path.concat(e,f.params.page)}var d=obips.catalog.Catalog.getSingleton();var c=d.getItemInfo(e);if(!c.isError()){var h=c.itemInfo;var g=f.editAction?saw.catalogaction.ActionId.EDIT:saw.catalogaction.ActionId.OPEN;var b=new saw.catalogaction.ActionContext("_self");b.bcItem=f;b.ensureFreshUrl=true;saw.catalogaction.getActionManager().handleAction(g,h.path,h.signature,h,null,b)}else{saw.catalog.showError(c.getErrorMessage())}}return false}};