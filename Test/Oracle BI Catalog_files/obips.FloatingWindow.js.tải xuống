obips.FloatingWindow={};obips.FloatingWindow.resourceFile="uicomponents/obips.FloatingWindow/obips.FloatingWindow.xml";obips.FloatingWindow.Manager=function(){var a=obips.getSingleton(obips.FloatingWindow.Manager.SINGLETON_NAME);if(a){if(document!=a.document){a._registerDocumentEvents(window)}return a}obips.FloatingWindow.Manager.baseConstructor.call(this);this.resourceManager=obips.ResourceManager.getSingleton();this.document=document;this.topLayerZIndex=1000;this._modalWindowCount=0;this._floatingWindowDivs=[];this._registerDocumentEvents(window);this._transientFloatingWindowViewer=null;globalRegister.addObject(obips.FloatingWindow.Manager.SINGLETON_NAME,this)};extend(obips.FloatingWindow.Manager,obips.Observable);obips.FloatingWindow.Manager.EventType=function(){};obips.FloatingWindow.Manager.EventType.MODAL_WINDOW_OPENED="modalWindowOpened";obips.FloatingWindow.Manager.EventType.MODAL_WINDOW_CLOSED="modalWindowClosed";obips.FloatingWindow.Manager.SINGLETON_NAME="floatingWindowManager";obips.FloatingWindow.Manager.getSingleton=function(){return obips.getSingleton(obips.FloatingWindow.Manager.SINGLETON_NAME)};obips.FloatingWindow.Manager.prototype.display=function(a){this.displayAtPosition(a,{xPos:a.xPixels,yPos:a.yPixels});a.focusWindow()};obips.FloatingWindow.Manager.prototype.displayAtPosition=function(e,a){if(this._transientFloatingWindowViewer!=null){var b=false;var d=e.parentFloatingWindow;while(d!=null){if(d==this._transientFloatingWindowViewer){b=true;break}d=d.parentFloatingWindow}if(!b){this.destroy(this._transientFloatingWindowViewer)}}if(saw.userAgent.is_touchdevice){obips.FloatingWindow.Manager.applyDummyClickListeners()}var c=e.floatingWindowDiv;c.style.visibility="hidden";if(c.parentNode!=c.ownerDocument.body){c.ownerDocument.body.appendChild(c)}if(!c.style.top){c.style.top="0px"}c.style.display="block";saw.positionPopup(c,a);c.style.visibility="visible";if(saw.menu){saw.menu.clearActiveMenu()}if(e.model.isModal){this.addInvisibleLayer(c.ownerDocument)}else{saw.addEventListener(c,"click",obips.FloatingWindow.Manager.onModelessWindowClicked,this)}this.setTopElementZIndex(c,e);if(e.model.isTransient&&!this._transientFloatingWindowViewer){this._transientFloatingWindowViewer=e}if(e.setLaunchElement&&!e.launchElement){var g=c.ownerDocument;if(a){if(a.evt){g=saw.getEventTarget(a.evt).ownerDocument}else{if(a.refDOMElement){g=a.refDOMElement.ownerDocument}}}var f=g.activeElement;if(f&&f!=g.body){e.setLaunchElement(f)}else{if(a){e.setLaunchElement(a.evt?saw.getEventTarget(a.evt):a.refDOMElement)}}}this.onFloatingWindowDisplayed(e)};obips.FloatingWindow.Manager.applyDummyClickListeners=function(){if(saw.userAgent.is_touchdevice){if(document.body){var a=saw.getFirstChildElement(document.body);while(a){if(a.onclick==undefined){a.onclick=function(){}}a=saw.getNextSiblingElement(a)}}}};obips.FloatingWindow.Manager.prototype.destroy=function(a){if(a){if(a.model.isTransient&&a.childFloatingWindow){this.destroy(a.childFloatingWindow);a.setChild(null)}if(a.controller&&a.controller.cleanupBeforeDestroy){a.controller.cleanupBeforeDestroy()}if(a.model.isModal){this.removeInvisibleLayer(a.floatingWindowDiv)}else{if(!a.model.isTransient&&this.topLayerZIndex==a.floatingWindowDiv.style.zIndex){this.topLayerZIndex--}}if(a==this._transientFloatingWindowViewer){this._transientFloatingWindowViewer=null}this.onFloatingWindowClosed(a);if(a.destroyedWindowCallback!=null){a.destroyedWindowCallback.exec()}if(a.floatingWindowDiv.parentNode){a.floatingWindowDiv.parentNode.removeChild(a.floatingWindowDiv)}}};obips.FloatingWindow.Manager.prototype.prepareDisplay=function(b){var a=b.floatingWindowDiv;if(a.parentNode!=a.ownerDocument.body){a.ownerDocument.body.appendChild(a)}a.style.visibility="hidden"};obips.FloatingWindow.Manager.prototype.hideTransientWindow=function(a){if(this._transientFloatingWindowViewer!=null){if(saw.userAgent.is_touchdevice){if(a&&(a.type=="touchstart")){var c=saw.getEventTarget(a);var b=this._transientFloatingWindowViewer.floatingWindowDiv;if(b){while(c){if(c==b){return}c=c.parentNode}}}}this.destroy(this._transientFloatingWindowViewer)}};obips.FloatingWindow.Manager.prototype.isDisplayingTransientWindow=function(){return((this._transientFloatingWindowViewer!=null)?true:false)};obips.FloatingWindow.Manager.prototype.hideTransientWindowOnScroll=function(a){if(saw.userAgent.is_smrtphone){return}if(this._transientFloatingWindowViewer!=null&&this._transientFloatingWindowViewer.hideOnScroll){var b=this._transientFloatingWindowViewer.floatingWindowDiv;if(b.offsetHeight<=saw.getClientHeight(b.ownerDocument)){this.destroy(this._transientFloatingWindowViewer)}}};obips.FloatingWindow.Manager.prototype.onFloatingWindowDisplayed=function(c,d){d=d||(c&&c.floatingWindowDiv);var b=c&&c.model&&c.model.isModal;if(this._modalWindowCount==0||(this._modalWindowCount==1&&b)){saw.hideTypeByTag("iframe",d,b,obips.FloatingWindow.Manager._hasEmbeddedApplication);if(is_nav){saw.hideCharts(d,b)}if(!b){this._floatingWindowDivs.push(d);if(!this._floatingWindowSizeCheckTimer){var a=this;this._floatingWindowSizeCheckTimer=setInterval(function(){a._handleFloatingWindowResize()},200)}}}};obips.FloatingWindow.Manager.prototype._handleFloatingWindowResize=function(){for(var a=0;a<this._floatingWindowDivs.length;a++){saw.hideTypeByTag("iframe",this._floatingWindowDivs[a],false,obips.FloatingWindow.Manager._hasEmbeddedApplication)}};obips.FloatingWindow.Manager._hasEmbeddedApplication=function(a){return a.getAttribute("embedsApp")=="true"};obips.FloatingWindow.Manager.prototype.onFloatingWindowClosed=function(a,b){if(this._modalWindowCount<=0){b=b||(a&&a.floatingWindowDiv);saw.showTypeByTag("iframe",b);if(is_nav){saw.showCharts(b)}}obips.Array.remove(this._floatingWindowDivs,b);if(this._floatingWindowSizeCheckTimer&&this._floatingWindowDivs.length==0){clearInterval(this._floatingWindowSizeCheckTimer);this._floatingWindowSizeCheckTimer=null}};obips.FloatingWindow.Manager.onModelessWindowClicked=function(a,f){var b=this;if(b.style.zIndex!=f.topLayerZIndex){var d=f.topLayerZIndex-1;var e=b.ownerDocument;var c=e.getElementById("invisibleLayer"+d);if(!c){f.setTopElementZIndex(b)}}};obips.FloatingWindow.Manager.prototype.addInvisibleLayer=function(c){this._modalWindowCount++;this.topLayerZIndex++;var d=this.topLayerZIndex;var a=c.createElement("div");c.body.appendChild(a);a.setAttribute("id","invisibleLayer"+d);a.oldBodyHeight=c.body.style.height;saw.appendNBSP(a);a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width=saw.getPageWidth(c)+"px";a.style.height=saw.getPageHeight(c)+"px";a.style.zIndex=d;a.className="OpaqueLayer";var b=this.findPreviousInvisibleLayer(c);if(b){b.className="TransparentLayer";saw.removeEventListener(window,"resize",obips.FloatingWindow.Manager.adjustInvisibleLayerSize)}saw.addEventListener(window,"resize",obips.FloatingWindow.Manager.adjustInvisibleLayerSize,a);this.notify(new obips.Observable.Event(obips.FloatingWindow.Manager.EventType.MODAL_WINDOW_OPENED))};obips.FloatingWindow.Manager.prototype.removeInvisibleLayer=function(d){this._modalWindowCount--;var c=d.style.zIndex-1;var e=d.ownerDocument;var b=e.getElementById("invisibleLayer"+c);if(b){e.body.style.height=b.oldBodyHeight;b.parentNode.removeChild(b);saw.removeEventListener(window,"resize",obips.FloatingWindow.Manager.adjustInvisibleLayerSize);var a=this.findPreviousInvisibleLayer(e);if(a){a.className="OpaqueLayer";obips.FloatingWindow.Manager.adjustInvisibleLayerSize(null,a);saw.addEventListener(window,"resize",obips.FloatingWindow.Manager.adjustInvisibleLayerSize,a)}if(this.topLayerZIndex==d.style.zIndex){this.topLayerZIndex-=2}}this.notify(new obips.Observable.Event(obips.FloatingWindow.Manager.EventType.MODAL_WINDOW_CLOSED))};obips.FloatingWindow.Manager.prototype.findPreviousInvisibleLayer=function(b){var c=this.topLayerZIndex-2;if(c>=0){var a=b.getElementById("invisibleLayer"+c);while(c>0&&a==null){c-=1;a=b.getElementById("invisibleLayer"+c)}}return a};obips.FloatingWindow.Manager.adjustInvisibleLayerSize=function(b,a){a.style.width="auto";a.style.height="auto";a.style.width=saw.getPageWidth(a.ownerDocument)+"px";a.style.height=saw.getPageHeight(a.ownerDocument)+"px"};obips.FloatingWindow.Manager.prototype.setTopElementZIndex=function(a,b){if(b&&b.model&&b.model.isTransient){a.style.zIndex=2147483647}else{this.topLayerZIndex++;a.style.zIndex=this.topLayerZIndex}};obips.FloatingWindow.Manager.prototype._registerDocumentEvents=function(b){try{if(b.obips_documentEventsRegistered){return}b.obips_documentEventsRegistered=true;var j=b.document;var d=new obips.Callback(this,this.hideTransientWindow);var i=new obips.BrowserEventFramework.EventRouter(j,"onclick");if(saw.userAgent.is_touchdevice){i=new obips.BrowserEventFramework.EventRouter(j,"ontouchstart")}var c=new obips.Observable.EventListener(null,d);i.addEventListener(c);var h=new obips.BrowserEventFramework.EventRouter(j,"oncontextmenu");var a=new obips.Observable.EventListener(null,d);h.addEventListener(a);var e=new obips.BrowserEventFramework.EventRouter(b,"onscroll");var f=new obips.Observable.EventListener(null,new obips.Callback(this,this.hideTransientWindowOnScroll));e.addEventListener(f)}catch(g){}};obips.FloatingWindow.Manager.prototype.registerScrollableContainers=function(c){if(typeof(c.length)!="number"){c=[c]}for(var b=0;b<c.length;b++){if(!c[b]._obips_FloatingWindowMangerScrollEventListened){var d=new obips.BrowserEventFramework.EventRouter(c[b],"onscroll");var a=new obips.Observable.EventListener(null,new obips.Callback(this,this.hideTransientWindowOnScroll));d.addEventListener(a)}c[b]._obips_FloatingWindowMangerScrollEventListened=true}};obips.FloatingWindow.Manager.registerDocument=function(a){a._registerDocumentEvents(window)};new obips.FloatingWindow.Manager();obips.FloatingWindow.Model=function(b,a){obips.FloatingWindow.Model.baseConstructor.call(this);this.isModal=b||false;this.isTransient=a||false};extend(obips.FloatingWindow.Model,obips.Observable);obips.FloatingWindow.Viewer=function(c,e,g,b,h,a){this.model=c;this.parentFloatingWindow=null;this.childFloatingWindow=null;this.floatingWindowManager=e;this.dialogManager=e;this.resourceManager=this.floatingWindowManager.resourceManager;this.floatingWindowDiv=document.createElement("div");this.floatingWindowDiv.className="floatingWindowDiv";this.floatingWindowDiv.floatingWindowViewer=this;if(g){this.floatingWindowDiv.style.width=g+"px"}if(b){this.floatingWindowDiv.style.height=b+"px"}this.xPixels=h;this.yPixels=a;this.destroyedWindowCallback=null;this.hideOnScroll=false;if(saw.userAgent.is_nav){var f=new obips.BrowserEventFramework.EventRouter(this.floatingWindowDiv,"onmousedown");f.addEventListener(new obips.Observable.EventListener(null,new obips.Callback(null,obips.FloatingWindow.Viewer.preventDefaultInFirefox)))}var d=new obips.BrowserEventFramework.EventRouter(this.floatingWindowDiv,((is_ie||saw.userAgent.is_webkit)?"onkeydown":"onkeypress"));d.addEventListener(new obips.Observable.EventListener(null,new obips.Callback(this,obips.FloatingWindow.Viewer.preventBrowserDefault)))};obips.FloatingWindow.Viewer.prototype.setDestroyedWindowCallback=function(a){this.destroyedWindowCallback=a};obips.FloatingWindow.Viewer.prototype.setChild=function(a){if(a==null&&this.childFloatingWindow!=null){this.childFloatingWindow.parentFloatingWindow=null}this.childFloatingWindow=a;if(this.childFloatingWindow!=null){this.childFloatingWindow.parentFloatingWindow=this}};obips.FloatingWindow.Viewer.prototype.setHideOnScroll=function(a){this.hideOnScroll=a||a==null};obips.FloatingWindow.Viewer.prototype.setLaunchElement=function(a){this.launchElement=a};obips.FloatingWindow.Viewer.prototype.focusLaunchElement=function(){if(this.launchElement){try{this.launchElement.focus()}catch(a){}}};obips.FloatingWindow.Viewer.prototype.focusWindow=function(){if(this.floatingWindowDiv&&this.floatingWindowDiv.focus){this.floatingWindowDiv.focus()}};obips.FloatingWindow.Viewer.prototype.isVisible=function(){var a=this.floatingWindowDiv;return a&&a.parentNode==a.ownerDocument.body&&a.style.display!="none"};obips.FloatingWindow.Viewer.preventBrowserDefault=function(b){var a=saw.getEventOwnerDocument(b).activeElement;if((b.keyCode==8||b.keyCode==46)&&a.type!="text"&&a.type!="textarea"&&a.type!="password"){this.floatingWindowManager.destroy(this);saw.preventEventDefault(b);saw.stopEventPropagation(b)}};obips.FloatingWindow.Viewer.preventDefaultInFirefox=function(a){if(a.ctrlKey){a.preventDefault();a.stopPropagation()}};obips.FloatingWindow.Viewer.getViewerFromEvent=function(a){a=obips.BrowserEventFramework.normalizeEvent(a);return obips.FloatingWindow.Viewer.getViewerFromElement(a.target)};obips.FloatingWindow.Viewer.getViewerFromElement=function(b){var a=b;while(a&&a.parentNode&&!a.floatingWindowViewer){a=a.parentNode}return(a)?a.floatingWindowViewer:null};obips.FloatingWindow.Controller=function(a){this.viewer=a};obips.FloatingWindow.Controller.prototype.destroyWindow=function(){this.viewer.floatingWindowManager.destroy(this.viewer)};obips.FloatingWindow.Controller.prototype.cleanupBeforeDestroy=function(){};obips.FloatingWindow.notifyEventPropagationStopped=function(a){obips.FloatingWindow.Manager.getSingleton().hideTransientWindow(a)};