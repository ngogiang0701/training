if(!obips.Switcher){obips.Switcher=function(){};obips.Switcher.Model=function(a,b){obips.Switcher.Model.baseConstructor.call(this);this.options=a;this.selected=b||this.options[0]};extend(obips.Switcher.Model,obips.Observable);obips.Switcher.Model.EventType=function(){};obips.Switcher.Model.EventType.SELECTION_CHANGED=1;obips.Switcher.Model.prototype.getSelectedOptionModel=function(){return this.selected};obips.Switcher.Viewer=function(c,e,b){this.model=c;this.container=e;this.popupHeight=b;this.currentContextSpan=saw.createChildElement(e,"span","SwitcherCurrentContext");this.currentContextSpan.appendChild(this.currentContextSpan.ownerDocument.createTextNode(this.model.selected.content.getCaption()));var a=saw.createChildElement(e,"span","SwitcherDropdown");var d=saw.createChildElement(a,"a","SwitcherDropdownIcon");a.getElementsByTagName("a")[0].style.backgroundImage="url("+obips.ResourceManager.getSingleton().getURL(obips.masterResourceBundlePath,"masterDropDownButtonEnabled").url+")";d.href="javascript:void(null)";d.onclick=obips.Switcher.Controller.onDropdownClicked;d.switcherViewer=this;this.dropdown=d;this.controller=new obips.Switcher.Controller(this)};obips.Switcher.Viewer.prototype.isPopupShown=function(){return this.popupViewer&&this.popupViewer.floatingWindowDiv&&this.popupViewer.floatingWindowDiv.style.display=="block"};obips.Switcher.Viewer.prototype.showPopup=function(b){var c=this.popupViewer.floatingWindowDiv;this.container.ownerDocument.body.appendChild(c);c.style.visibility="hidden";c.style.display="block";var a=0;if(this.popupHeight){var d=this.popupHeight;if(this.popupViewer.bodyDiv.offsetHeight>d){c.style.height=d+"px";a=17}else{c.style.height="auto"}}if(saw.userAgent.is_ie){c.style.width=this.popupViewer.bodyDiv.offsetWidth+a+"px"}obips.FloatingWindow.Manager.getSingleton().displayAtPosition(this.popupViewer,saw.Position.createByDOMElement(this.dropdown));if(saw.getEvent(b).clientX==0){this.popupViewer.focus()}c.style.visibility="visible"};obips.Switcher.Viewer.prototype.hidePopup=function(){if(this.popupViewer&&this.popupViewer.floatingWindowDiv){this.popupViewer.floatingWindowDiv.style.display="none";obips.CSS.removeClassFromElement(this.dropdown,"SwitcherDropdownIconDown");this.dropdown.style.backgroundImage="url("+obips.ResourceManager.getSingleton().getURL(obips.masterResourceBundlePath,"masterDropDownButtonEnabled").url+")";obips.FloatingWindow.Manager.getSingleton().destroy(this.popupViewer)}};obips.Switcher.OptionContent=function(b,a){this.value=b;this.caption=a};obips.Switcher.OptionContent.prototype.getValue=function(){return this.value};obips.Switcher.OptionContent.prototype.getCaption=function(){return this.caption};obips.Switcher.OptionContent.prototype.render=function(a){a.appendChild(a.ownerDocument.createTextNode(this.getCaption()))};obips.Switcher.OptionModel=function(a){this.content=a};obips.Switcher.OptionViewer=function(c,d,a){this.switcherViewer=a;this.model=c;var b=saw.createChildElement(d,"div","masterMenuItem SwitcherOption");this.model.content.render(b);b.onmouseover=function(){obips.CSS.addClassToElement(this,"SwitcherOptionHover")};b.onmouseout=function(){obips.CSS.removeClassFromElement(this,"SwitcherOptionHover")};b.onclick=obips.Switcher.Controller.onOptionClicked;b.optionViewer=this;b.tabIndex=0};obips.Switcher.PopupViewer=function(a){this.model={isTransient:true};this.controller={viewer:a};this.options=a.model.options;this.floatingWindowDiv=a.container.ownerDocument.createElement("div");this.floatingWindowDiv.className="masterMenu SwitcherPopup";this.bodyDiv=saw.createChildElement(this.floatingWindowDiv,"div","SwitcherPopupBody");this.bodyDiv.onkeyup=function(d){if(saw.getEvent(d).keyCode==27){a.hidePopup();a.dropdown.focus()}};for(var c=0;c<this.options.length;c++){if(this.options[c]){new obips.Switcher.OptionViewer(this.options[c],this.bodyDiv,a)}else{var b=saw.createChildElement(this.bodyDiv,"div","masterMenuItemSeparator SwitcherOptionSeparator");saw.appendNBSP(b)}}};obips.Switcher.PopupViewer.prototype.focus=function(){saw.getFirstChildElement(this.bodyDiv).focus()};obips.Switcher.Controller=function(a){this.viewer=a;saw.addEventListener(document,"click",this.onclickOutsideHandler,this,true)};obips.Switcher.Controller.onDropdownClicked=function(a){a=saw.getEvent(a);var b=saw.getEventTarget(a).switcherViewer;if(b.isPopupShown()){b.hidePopup()}else{if(!b.popupViewer){b.popupViewer=new obips.Switcher.PopupViewer(b)}b.showPopup(a)}obips.CSS.addClassToElement(b.dropdown,"SwitcherDropdownIconDown");b.dropdown.style.backgroundImage="url("+obips.ResourceManager.getSingleton().getURL(obips.masterResourceBundlePath,"masterDropDownButtonDown").url+")";saw.stopEventPropagation(a)};obips.Switcher.Controller.onOptionClicked=function(b){b=saw.getEvent(b);var d=saw.getEventTarget(b).optionViewer;var a=d.switcherViewer;a.hidePopup();saw.clearInnerHTML(a.currentContextSpan);a.currentContextSpan.appendChild(a.currentContextSpan.ownerDocument.createTextNode(d.model.content.getCaption()));if(d.model!=a.model.selected){a.model.selected=d.model;var c=d.model.content;a.model.notify(new obips.Observable.Event(obips.Switcher.Model.EventType.SELECTION_CHANGED,c))}saw.stopEventPropagation(b)};obips.Switcher.Controller.prototype.onclickOutsideHandler=function(a){this.viewer.hidePopup()}};